var Service_Store=new function(){this.setLocal=function(key,value){try{window.localStorage.setItem(key,value)}catch(e){window.localStorage.setItem(key,null)}},this.getLocal=function(key){try{return window.localStorage.getItem(key)}catch(e){return null}},this.removeKey=function(key){try{window.localStorage.removeItem(key)}catch(e){}},this.clearAll=function(){try{localStorage.clear()}catch(e){}}},Service_Baseurl=new function(){this.getBaseURL=function(){return window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+"/"}},login=angular.module("starter");login.controller("Login",["$scope","$ionicPopup","$location","$window","$ionicLoading","$state","$cordovaToast",function($scope,$ionicPopup,$location,$window,$ionicLoading,$state,$cordovaToast){loader.dependency=$ionicLoading,$scope.signup_title="Login",$scope.show_content=!1,$scope.loginData={};var jsonresponse=Service_Store.getLocal("parentdata");if(""!=jsonresponse&&null!=jsonresponse){for(var json=JSON.parse(jsonresponse),i=0;i<json.length;i++)var user_type=(json[0].id,json[0].name,json[0].email,json[0].member_no,json[0].type),status=(json[0].school_id,json[0].image,json[0].status);2!=user_type&&1!=user_type&&5!=user_type||($window.location.href="#/dashboard"),3==user_type&&($window.location.href="#/home/classstoryparent"),4==user_type&&($state.go("st_home.studentinvite"),"0"==status&&window.plugins.toast.show("Account not verified","short","center"))}$scope.loginUser=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/login?token="+Service_Store.getLocal("app_token")+"&email="+$scope.loginData.email_id+"&password="+$scope.loginData.password,$scope.loginResponse)},$scope.loginResponse=function(resp){var obj=$.parseJSON(resp),deviceId=Service_Store.getLocal("das_device_id"),app_token=Service_Store.getLocal("app_token");if(Service_Store.clearAll(),Service_Store.setLocal("das_device_id",deviceId),Service_Store.setLocal("app_token",app_token),"Success"==obj.status){var jsonresponse=obj.user_list;Service_Store.setLocal("parentdata",JSON.stringify(jsonresponse)),"2"==obj.user_list[0].type||"1"==obj.user_list[0].type||"5"==obj.user_list[0].type?(1==obj.hasOwnProperty("school")&&Service_Store.setLocal("school",JSON.stringify(obj.school)),$window.location.href="#/dashboard"):"3"==obj.user_list[0].type?$window.location.href="#/home/class_story":"4"==obj.user_list[0].type&&($window.location.href="#/st_home/studentinvite","0"==obj.user_list[0].status&&window.plugins.toast.show("Account not verified","short","center"))}else 1==resp.error_code?global._alert({template:resp.error_msg,dependency:$ionicPopup}):global._alert({template:"Please check username or password",dependency:$ionicPopup})}}]),login.controller("Forgetpassword",["$scope","$ionicPopup","$location","$state","$ionicPopup","$ionicLoading",function($scope,$ionicPopup,$location,$state,$ionicPopup,$ionicLoading){$scope.forgotPassword=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/sendmail?token="+Service_Store.getLocal("app_token")+"&email="+$scope.useremail+"&id=10",$scope.loginResponse=function(resp){var res=JSON.parse(resp);"Success"==res.status?(global._alert({template:"Password reset has been sent to your email id",dependency:$ionicPopup}),$state.go("login")):($scope.hide(),global._alert({template:"Email address not registered",dependency:$ionicPopup}))})},$scope.close_reset_password=function(){$state.go("login")}}]);var app=angular.module("starter");app.controller("SingupController",function($scope){$scope.signup_title="Signup As",$scope.signup_content_class="sign-as",$scope.signup_content="Sign up for ClassGenie as a...",$scope.show_content=!0});var parent=angular.module("starter");parent.controller("parentRegister",["$scope","$ionicPopup","$location","$window","$ionicHistory","$ionicLoading",function($scope,$ionicPopup,$location,$window,$ionicHistory,$ionicLoading){loader.dependency=$ionicLoading,$scope.signup_title="Parent Signup",$scope.signup_content_class="signup-already",$scope.signup_content="<p>Get ready for your best classroom yet :)</p>",$scope.show_content=!0,$scope.par={},$scope.minlength=6,$scope.passvalidation=function(item){$("#passsword").val().length<6?$("#passsword").css({border:"1px solid #F83A39"}):$("#passsword").val().length>=6&&$("#passsword").css({border:""})},$scope.doParentSignUp=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/parent?token="+Service_Store.getLocal("app_token"),{name:$scope.par.fname,email:$scope.par.email,password:$("#passsword").val(),phone:$scope.par.phone},$scope.signupResponse=function(resp){if("Failure"==resp.status)global._alert({template:resp.comments,dependency:$ionicPopup});else if("Success"==resp.status){var jsonresponse=resp.user_list;for(Service_Store.setLocal("parentdata",JSON.stringify(jsonresponse)),i=0;i<=jsonresponse.length;i++)3==jsonresponse[0].type&&($window.location.href="#/check_parent_code")}else 1==resp.error_code?global._alert({template:resp.error_msg,dependency:$ionicPopup}):global._alert({template:resp.comments,dependency:$ionicPopup})})}}]);var student_signup=angular.module("starter");student_signup.controller("studentRegister",["$scope","$window","$ionicPopup","$cordovaToast","$state","$ionicLoading",function($scope,$window,$ionicPopup,$cordovaToast,$state,$ionicLoading){loader.dependency=$ionicLoading,$scope.signup_title="Student Signup",$scope.show_content=!1,$scope.alreadyexist=!0,$scope.ageValue="Age",$scope.loginData={},$scope.checkcode=!0,$("#hidden_fields").hide(),$("#signup").hide(),$scope.message=!0,$scope.parentemail,$scope.toggleCustom=function(){$scope.message=$scope.message===!1},$scope.checkUserName=function(){$scope.count;if($scope.loginData.studentcode.length>=4)global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/student/add?token="+Service_Store.getLocal("app_token")+"&student_no="+$scope.loginData.studentcode,{},$scope.studentSignupResponse=function(resp){"Success"==resp.status?($scope.checkcode=!0,$("#signup").show(),$("#hidden_fields").show(),$("#checkuser").hide(),$("#user").hide(),$scope.id=resp.user_list[0].id,$scope.student_no=resp.user_list[0].student_no):"Failure"==resp.status?($scope.response=resp.comments,global._alert({template:$scope.response,dependency:$ionicPopup})):1==res1.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})});else{var message="Code length too short..";global._alert({template:message,dependency:$ionicPopup})}},$scope.studentSignup=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/student?token="+Service_Store.getLocal("app_token"),{username:$scope.loginData.username,age:$scope.ageValue,password:$scope.loginData.password,id:$scope.id,student_no:$scope.student_no},$scope.loginResponse=function(resp){if("Success"==resp.status){var jsonresponse=resp.user_list;if(4==resp.user_list[0].type){var stud_data=JSON.stringify(jsonresponse);Service_Store.setLocal("parentdata",stud_data),Service_Store.setLocal("signup","1"),Service_Store.setLocal("studentcode",$scope.loginData.studentcode),$state.go("st_home.studentinvite")}}else"Failure"==resp.status?global._alert({template:resp.comments,dependency:$ionicPopup}):1==resp.error_code?global._alert({template:resp.error_msg,dependency:$ionicPopup}):global._alert({template:"server issue while saving,Please try after some time",dependency:$ionicPopup})})},$scope.numberfocus=function(){$scope.alreadyexist=!0}}]);var dashboard=angular.module("starter");dashboard.controller("dashboardCtrl",["$scope","$window","$location","$state","$cordovaSocialSharing","$ionicModal","$state","$ionicPopup","$ionicLoading","$cordovaToast",function($scope,$window,$location,$state,$cordovaSocialSharing,$ionicModal,$state,$ionicPopup,$ionicLoading,$cordovaToast){loader.dependency=$ionicLoading,$scope.imagePath=global.config.file_url+global.config.image_path;var jsonresponse=Service_Store.getLocal("parentdata"),deviceId=Service_Store.getLocal("das_device_id");Service_Store.getLocal("profile_status");Service_Store.setLocal("profile_status","1");for(var json=JSON.parse(jsonresponse),i=0;i<json.length;i++){var name=(json[0].id,json[0].name),member_no=(json[0].email,json[0].member_no),user_type=json[0].type,school_id=json[0].school_id,userImage=json[0].image;json[0].status}if(0==school_id||void 0==school_id)$scope.school="Join Your School",$scope.subtitle="Connect with teachers at your school";else if("undefined"!=typeof Service_Store.getLocal("school")){var school=JSON.parse(Service_Store.getLocal("school"));Array.isArray(school)&&school.length>0?$scope.school=school=school[0].school_name:$scope.school=school=""}$scope.username=name,Service_Store.setLocal("das_member_no",member_no),Service_Store.setLocal("das_username",name),""!=userImage?Service_Store.setLocal("das_userimage",userImage):userImage=Service_Store.getLocal("das_userimage"),userImage?$scope.imgURI=global.config.file_url+global.config.image_path+"profile_image/"+userImage+"?"+global.randomNumber():$scope.imgURI="img/chat_user.png?"+global.randomNumber(),$scope.removeDollerChar=function(string){return string.replace("$","?")},loadData=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classinfo/dashboard?token="+Service_Store.getLocal("app_token")+"&teacher_ac_no="+member_no,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);"Success"==res1.status?$scope.items=res1.user_list:1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},loadData(),deviceRegister=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/save_deviceid?token="+Service_Store.getLocal("app_token"),{member_no:member_no,device_id:deviceId},function(resp){ajaxloader.async=!0})},$scope.varify="",$scope.schoolvarify=function(){ajaxloader.load(global.config.api_url+"/teacher/search?token="+Service_Store.getLocal("app_token")+"&member_no="+member_no,function(resp){var res1=$.parseJSON(resp);"Success"==res1.status?"1"==res1.user_list[0].status&&0!=school_id?$state.go("school_story"):"0"==res1.user_list[0].status&&0!=school_id&&window.plugins.toast.show("School verification is under process...","short","center"):1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},deviceRegister(),$scope.schoolinfo=function(){0==school_id?(5==user_type||1==user_type?$scope.hideshow=!1:$scope.hideshow=!0,$ionicModal.fromTemplateUrl("templates/school.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})):$scope.schoolvarify()},$scope.openClassDetail=function(){var classid=this.item.class_id,className=this.item.class_name;Service_Store.setLocal("das_classid",classid),Service_Store.setLocal("das_classname",className),Service_Store.setLocal("das_classBack","dashback"),$window.location.href="#/tab/"+classid+"/classroom"},$scope.shareSocial=function(){var message="Build your own classroom community this year with Classgenie. "+$scope.username+" and other teachers of your school have already joined this community and hope that you will also love this. Turn your classroom into a digital one with Classgenie, encourage students, coordinate with parents, share school posts or classroom activities images or video or candid moments of the kids with their parents.";$cordovaSocialSharing.share("Classgenie","Classgenie App","img/logo.jpg",""+message+"http://www.classgenie.in")},$scope.OpenSchoolStory=function(){$state.go("school_story")}}]);var school=angular.module("starter");school.controller("ctrlSchool",["$scope","$ionicModal","$cordovaToast","$window","$ionicPopup","$ionicLoading",function($scope,$ionicModal,$cordovaToast,$window,$ionicPopup,$ionicLoading){loader.dependency=$ionicLoading,$scope.school_name="",$scope.addlink=!0;var jsonresponse=Service_Store.getLocal("parentdata"),json=JSON.parse(jsonresponse),member_no=json[0].member_no;ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/schools/list?token="+Service_Store.getLocal("app_token")+"&member_no="+member_no,function(resp){$scope.mylist_data=$.parseJSON(resp).school_list,ajaxloader.async=!0}),$scope.seachSchool=function(school_name){var myLength=$("#search").val().length;myLength>0?$scope.addlink=!1:$scope.addlink=!0,ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/schools/search?token="+Service_Store.getLocal("app_token")+"&school_name="+school_name,function(resp){$scope.mylist_data=$.parseJSON(resp).school_list,ajaxloader.async=!0})},$scope.seachSchoolKeyup=function(school_name,keyEvent){var myLength=$("#search").val().length;myLength>0?$scope.addlink=!1:$scope.addlink=!0,$scope.seachSchool(school_name),$scope.school_name=school_name},$scope.selectedItem=function(elem,item){var schoolinfo=JSON.stringify(item);Service_Store.setLocal("selected_school",schoolinfo),$("#classgenie_school_list a").removeClass("activated"),$("#classgenie_school_list #"+elem).addClass("activated"),$scope.modal.remove(),openteacherlist()},openteacherlist=function(){$ionicModal.fromTemplateUrl("templates/school_teacher_list.html",{scope:null,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})},$scope.sendDashboard=function(){Service_Store.setLocal("selected_school_id",0),window.location.href="#/dashboard"},$scope.sendRequestTeacherlist=function(){window.location.href="#/school_teacher_list"},$scope.skipaddschool=function(){$scope.modal.remove()},$scope.add_school=function(){var school_name=$scope.school_name;Service_Store.setLocal("joinschool",school_name),$scope.modal.remove(),$ionicModal.fromTemplateUrl("templates/createschool.html",{scope:null,controller:"addschool",animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})}}]);var addschool=angular.module("starter");addschool.controller("addschool",["$scope","$ionicModal","$state","$window","$ionicPopup",function($scope,$ionicModal,$state,$window,$ionicPopup){var jsonresponse=Service_Store.getLocal("parentdata"),json=JSON.parse(jsonresponse),teachername=json[0].name;$scope.school={},$scope.school.schoolname=Service_Store.getLocal("joinschool"),$scope.saveschool=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/schools/addschoolslist?token="+Service_Store.getLocal("app_token"),{school_name:$scope.school.schoolname,address:$scope.school.address,city:$scope.school.city,state:$scope.school.state,country:$scope.school.country,pincode:$scope.school.pin,phone:$scope.school.phone,email_id:$scope.school.email,web_url:$scope.school.site,member_no:Service_Store.getLocal("das_member_no")},$scope.addschoolResponse)},$scope.addschoolResponse=function(resp){if("Success"==resp.status){$scope.modal.remove(),$ionicModal.fromTemplateUrl("templates/schoolcreated.html",{scope:null,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()});var message="School created, sent for approval",newschool=[];return newschool.push({school_name:resp.teacher_list[0].school_name}),json[0].school_id=resp.teacher_list[0].school_id,user=JSON.stringify(json),Service_Store.setLocal("parentdata",user),Service_Store.setLocal("school",JSON.stringify(newschool)),$state.go("dashboard",{},{reload:!0}),$scope.approveSchool(),window.plugins.toast.show(message,"short","center"),void Service_Store.setLocal("joinschool",$scope.school.schoolname)}1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})},$scope.approveSchool=function(){ajaxloader.load(global.config.api_url+"/sendmail?token="+Service_Store.getLocal("app_token")+"&id=6&teacher_name="+teachername+"&school_name="+$scope.school.schoolname,{},$scope.sentinvite=function(resp){"Success"==resp.status})},$scope.closepopup=function(){$scope.modal.remove()}}]),school.controller("sendinvite",["$scope","$state","$cordovaSocialSharing",function($scope,$state,$cordovaSocialSharing){$scope.school=Service_Store.getLocal("joinschool"),$scope.skipinvitee=function(){$scope.modal.remove(),$state.go("dashboard",{},{reload:!0})},$scope.closepopup=function(){$scope.modal.remove(),$state.go("dashboard",{},{reload:!0})},$scope.inviteteachers=function(){$cordovaSocialSharing.share("Classgenie","Classgenie App","img/logo.jpg","https://www.xyz.com")}}]);var school=angular.module("starter");school.controller("ctrlSchoolTeacherList",["$scope","$ionicModal","$state","$base64","$ionicPopup","$ionicLoading",function($scope,$ionicModal,$state,$base64,$ionicPopup,$ionicLoading){loader.dependency=$ionicLoading;var data=JSON.parse(Service_Store.getLocal("selected_school"));data=JSON.parse(data),$scope.school=data.school_name;var school_id=data.school_id;$scope.schooladd=data.address,$scope.member_no=Service_Store.getLocal("das_member_no"),$scope.imagepath=global.config.file_url+global.config.image_path+"profile_image/";var user=Service_Store.getLocal("parentdata");user=JSON.parse(user),global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/schools/teacherlist?token="+Service_Store.getLocal("app_token")+"&school_id="+school_id,function(resp){var resp=JSON.parse(resp);"Success"==resp.status?($scope.items=resp.Teacher_list,$scope.listsize=$scope.items.length):$scope.listsize=resp.comments}),$scope.closepopup=function(){$scope.modal.remove()},$scope.joinschool=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/schools/joinschools?token="+Service_Store.getLocal("app_token")+"&school_id="+school_id+"&member_no="+$scope.member_no,{school_id:school_id,member_no:$scope.member_no},$scope.joinresponse=function(resp){if("Success"==resp.status){var newschool=[];newschool.push({school_name:$scope.school}),user[0].school_id=school_id,user=JSON.stringify(user),Service_Store.setLocal("parentdata",user),Service_Store.setLocal("school",JSON.stringify(newschool)),$state.go("dashboard",{},{reload:!0}),sendrequest()&&$scope.modal.remove();var message="You Joined the school";window.plugins.toast.show(message,"short","center")}else if("failure"==resp.status)var message=resp.comments;else 1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup});window.plugins.toast.show(message,"short","center")})},sendrequest=function(){if("undefined"!=typeof $scope.items){$scope.listsize=$scope.items.length;var mailid=[];for(i=0;i<$scope.listsize;i++)mailid.push({value:$scope.items[i].email});var emaildata={data:{member_no:$scope.member_no,name:user[0].name,email:{mailid:mailid}}};emaildata=JSON.stringify(emaildata),emaildata=$base64.encode(emaildata),global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/sendmail?token="+Service_Store.getLocal("app_token")+"&id=5",{data:emaildata},$scope.sentinvite=function(resp){"Success"==resp.status&&$scope.modal.remove()})}$scope.modal.remove()}}]);var classroom=angular.module("starter");classroom.controller("classroomCtrl",["$scope","$window","$location","$state","$ionicPopup","$ionicModal","$ionicHistory","$ionicLoading","$ionicPopover","$ionicLoading","$cordovaToast",function($scope,$window,$location,$state,$ionicPopup,$ionicModal,$ionicHistory,$ionicLoading,$ionicPopover,$ionicLoading,$cordovaToast){loader.dependency=$ionicLoading,$scope.footer=!1,$scope.addmultiple=!0,$scope.classroom=!1,$scope.addmultiplescreen=!0,$scope.selectstudent=!0,$scope.selectone=!1,$scope.selectallcheck=!0,$scope.selectall=!0,$scope.wholeclass=!1,$scope.showstudent=!1,$scope.showgroup=!0,$scope.posbutton="award_tab",$scope.needbutton="",$scope.disablegroup=!1,$scope.positive=!0,$scope.studbutton=!1,$scope.groupbutton=!1,Service_Store.removeKey("groupdata"),Service_Store.removeKey("groupinfo");var stored_classId=Service_Store.getLocal("das_classid");Service_Store.setLocal("datetoken","today"),$scope.imagePath=global.config.file_url+global.config.image_path,$scope.show=function(){$ionicLoading.show({template:'<ion-spinner icon="android"></ion-spinner>'}).then(function(){})},$scope.hide=function(){$ionicLoading.hide().then(function(){})},loadstudent=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if("Success"==res1.status){var class_studentlist=res1.class_details.student_list;$scope.className=res1.class_details.class_name,$scope.classImage=res1.class_details.image,$scope.classPoints=res1.class_details.pointweight,$scope.items=class_studentlist;var classgrade=res1.class_details.grade;Service_Store.setLocal("das_classname",$scope.className),Service_Store.setLocal("das_classImage",$scope.classImage),Service_Store.setLocal("das_classGrade",classgrade)}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},loadstudent(),$scope.openSideMenu=function($event){$scope.popover_items=[{name:"Edit Skill"},{name:"Edit Student"},{name:"Edit Classname"},{name:"Invite Parents"},{name:"Pending Stories"}];var template='<ion-popover-view class="dropdownsetting classroom_pouup"><ion-content><ul class="list"><li class="item" on-tap="openEditClass()"><a>Edit/Remove class</a></li><li class="item" on-tap="openStudentList()"><a>Edit students</a></li><li class="item" on-tap="openEditskill()"><a>Edit skills</a></li><li class="item" on-tap="inviteparent()"><a>Invite Parents</a></li><li class="item" on-tap="pending_story()"><a>Pending Stories</a></li><li class="item" on-tap="assignment_list()"><a>Assignment List</a></li></ul></ion-content></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.openStudentList=function(){$scope.popover.hide(),$window.location.href="#/editstudentlist"},$scope.openEditskill=function(){$scope.popover.hide(),$window.location.href="#/editskills"},$scope.openEditClass=function(){$scope.popover.hide(),$window.location.href="#/editclass_name"},$scope.inviteparent=function(){$state.go("inviteparent"),$scope.closePopover()}},$scope.openStudentReward=function(multiple){var stored_classId=Service_Store.getLocal("das_classid");Service_Store.getLocal("das_member_no");if(void 0==multiple)var studentId=this.item.id,studentNo=this.item.student_no,url="/points/student/update";else var studentId=multiple,url="/awardmultiple/class";$scope.student=this.item.name,$ionicModal.fromTemplateUrl("templates/awardpopup.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()});var stored_classId=Service_Store.getLocal("das_classid");global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/points/student?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.needwork=!1,$scope.positive=!0;var data1=res1.user_list;$scope.award_items=data1,$scope.needwork_items=res1.needwork,ajaxloader.async=!0}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})}),$scope.closeAwardPopUp=function(){$scope.modal.hide()},$scope.giveReward=function(){if("/points/student/update"==url)global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{id:studentId,pointweight:this.item.pointweight,customize_skills_id:this.item.id,class_id:stored_classId,student_no:studentNo},function(resp){"Success"==resp.status?loadstudent():1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})}),$scope.modal.hide();else if("/awardmultiple/class"==url){var data={id:studentId,pointweight:this.item.pointweight,class_id:stored_classId,customize_skills_id:this.item.id};data=JSON.stringify(data),global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{data:data},function(resp){"Success"==resp.status?($scope.footer=!1,$scope.addmultiple=!0,$scope.classroom=!1,$scope.addmultiplescreen=!0,$scope.selectstudent=!0,$scope.selectone=!1,$state.go("tab.classroom",{},{reload:!0})):1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})}),$scope.modal.hide()}}},$scope.openClassReward=function(){var stored_classId=Service_Store.getLocal("das_classid");ajaxloader.load(global.config.api_url+"/points/class/?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);"Success"==res1.status?($scope.positive=!0,$scope.needwork=!1,$scope.class_award_items=res1.user_list,$scope.needwork_items=res1.needwork,ajaxloader.async=!0):1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup}),$scope.close_classreward=function(){$scope.modal.remove()}}),$ionicModal.fromTemplateUrl("templates/class_award_popup.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()})},$scope.wholeClassReward=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/points/class/update?token="+Service_Store.getLocal("app_token"),{pointweight:this.item.pointweight,customize_skills_id:this.item.id,class_id:stored_classId},function(resp){"Success"==resp.status&&loadstudent()}),$scope.modal.hide()},$scope.addStudent=function(){$window.location.href="#/addstudent",Service_Store.setLocal("das_classBack","classback")},$scope.closeClassPopup=function(){$scope.modal.hide()},$scope.goBack=function(){$state.go("dashboard")},$scope.positiveButton=function(){$scope.posbutton="award_tab",$scope.needbutton="",$scope.positive=!0,$scope.needwork=!1},$scope.needButton=function(){$scope.posbutton="",$scope.needbutton="award_tab",$scope.needwork=!0,$scope.positive=!1},$scope.openAddGroup=function(){$window.location.href="#/add_group"},$scope.selectmultiple=function(){$scope.studbutton=!0,$scope.groupbutton=!0,$scope.disablegroup=!0,$scope.footer=!0,$scope.addmultiple=!1,$scope.classroom=!0,$scope.addmultiplescreen=!1,$scope.selectstudent=!1,$scope.studentselected=!0,$scope.selectone=!0,$scope.selectallcheck=!1,$scope.check="Select All",$scope.wholeclass=!0},$scope.closeawardmultiple=function(){$scope.studbutton=!1,$scope.groupbutton=!1,$scope.disablegroup=!1,$state.go("tab.classroom",{},{reload:!0})},$scope.addpoint=[],$scope.selected=function(item){if($scope.item={},1==item)$("#selectall").prop("checked")?($scope.check="Deselect All",$scope.items.forEach(function(entry){$("#item_"+entry.id).prop("checked",!0),$("#check_"+entry.id).css({"background-color":"#ccc"});var pos=$scope.addpoint.indexOf(entry.id);1==pos&&$scope.addpoint.splice(pos),$scope.addpoint.push(entry.id);$scope.addpoint.indexOf(entry.id)}),$scope.studentselected=!1,$("#multiple").css({"background-color":"rgb(40, 90, 69)",color:"#fff"})):($scope.check="Select All",$scope.items.forEach(function(entry){$("#item_"+entry.id).prop("checked",!1),$("#check_"+entry.id).css({"background-color":""}),$scope.addpoint=[]}),$scope.studentselected=!0,$("#multiple").css({"background-color":"#fff",color:"#000"}));else if($("#selectall").prop("checked",!1),$("#item_"+item).prop("checked"))$("#check_"+item).css({"background-color":"#ccc"}),$scope.addpoint.push(item),$scope.studentselected=!1,$("#multiple").css({"background-color":"rgb(40, 90, 69)",color:"#fff"});else{$("#check_"+item).css({"background-color":""});var index=$scope.addpoint.indexOf(item);index>-1&&($scope.addpoint.splice(index,1),$scope.addpoint.length<1&&($scope.studentselected=!0,$("#multiple").css({"background-color":"#fff",color:"#000"})))}var length=$scope.items.length;$scope.count=length,$scope.count=$scope.addpoint.length},$scope.awardmultiplestudents=function(){var data=$scope.addpoint,id=data;id.length>0?(JSON.stringify(id),$scope.openStudentReward(data)):id.length<1&&window.plugins.toast.show("select students to award points","short","center")},$scope.checkitem=function(item){$("#item_"+item).prop("checked")?($("#item_"+item).prop("checked",!1),$("#check_"+item).css({"background-color":""})):($("#item_"+item).prop("checked",!0),$("#check_"+item).css({"background-color":"#ccc"})),$scope.selected(item)},$scope.selectAlldiv=function(){$("#selectall").prop("checked")?($("#selectall").prop("checked",!1),$scope.selected(1)):($("#selectall").prop("checked",!0),$scope.selected(1))},$scope.showclassscreen=function(){loadstudent(),$scope.showstudent=!1,$scope.showgroup=!0,$scope.showstud="award_tab",$scope.showgrp="",$scope.footer=!1,$scope.giveaward=!1},$scope.showgroupscreen=function(){loadGroup(),$scope.showstudent=!0,$scope.showgroup=!1,$scope.showstud="",$scope.showgrp="award_tab",$scope.footer=!0,$scope.giveaward=!0},$scope.showclassscreen(),$scope.takeAttendance=function(){$window.location.href="#/attendance_list"},$scope.ViewReport=function(){$state.go("viewReport")},$scope.getReport=function(item){var datetoken=Service_Store.getLocal("datetoken");$ionicModal.fromTemplateUrl("templates/your_kid_performance.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()});var student=item.student_no,class_id=stored_classId,datetoken="thismonth";$scope.name=item.name,$scope.goBack=function(){$scope.modal.remove()},$scope.getDate=function(event){var id=event.target.id;$("#"+id).addClass("ion-checkmark-round"),$scope.datetokenview=event.target.attributes.value.value,$scope.closePopover(),Service_Store.setLocal("datetoken",id);var datetoken=Service_Store.getLocal("datetoken");$scope.getStudentData(student,class_id,datetoken)},$scope.getStudentData(student,class_id,datetoken)},$(document).ready(function(){$scope.getStudentData=function(student,class_id,datetoken){var url=global.config.api_url+"/report/student?token="+Service_Store.getLocal("app_token")+"&class_id="+class_id+"&student_info_no="+student+"&datetoken="+datetoken;ajaxloader.load(url,function(resp){var res1=$.parseJSON(resp);if("Failure"!=res1.status){$scope.show(),$scope.nocontent=!0,$scope.graph=!1;$scope.teacher_name=res1.teacher_name[0].name,$scope.time="";var skill_list=res1.point;$scope.pos_total=0,$scope.need_total=0,skill_list.forEach(function(skill_list){if(skill_list.customize_detail.pointweight>0){var pos_skillcount=skill_list.point;$scope.pos_total+=pos_skillcount}else if(skill_list.customize_detail.pointweight<0){var need_skillcount=skill_list.point*-1;$scope.need_total+=need_skillcount}});var positive_skill=Math.round($scope.pos_total/($scope.pos_total+$scope.need_total)*100),needwork_skill=Math.round($scope.need_total/($scope.pos_total+$scope.need_total)*100);FusionCharts.ready(function(){var fusioncharts=new FusionCharts({type:"doughnut2d",renderAt:"chart-container",width:"450",height:"450",dataFormat:"json",dataSource:{chart:{caption:"",subCaption:"",numberPrefix:"%",startingAngle:"310",decimals:"0",defaultCenterLabel:""+positive_skill+"% Positive",centerLabel:"$label : $value",useDataPlotColorForLabels:"1",theme:"fint"},data:[{label:"Need Work",value:needwork_skill},{label:"Positive",value:positive_skill}]}});try{fusioncharts.render(),$scope.award_data=res1.point,$scope.hide()}catch(e){$scope.disconnected=!1,$scope.award_data="",$scope.nocontent=!1,$scope.graph=!0}})}"Failure"==res1.status&&($scope.disconnected=!1,$scope.award_data="",$scope.nocontent=!1,$scope.graph=!0)})}}),$scope.classroom_page=function(){window.location.href="#/tab/"+stored_classId+"/classroom"},$scope.selectDate=function($event){$scope.popover_items=[{name:"Today"},{name:"This Week"},{name:"This Month"},{name:"Date range"}];var template='<ion-popover-view class="dropdownsetting stud"><ion-content><ul class="list" ><a><li class="item" id="today"     value="Today"     on-tap="getDate($event)">Today</li></a><a><li class="item" id="thisweek"  value="This Week"  on-tap="getDate($event)">This Week</li></a><a><li class="item" id="thismonth" value="This Month" on-tap="getDate($event)">This Month</li></a></ul></ion-content></ion-popover-view>';
$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){})},$scope.pending_story=function(){$scope.popover.hide(),$state.go("pending_story_studentlist")},$scope.assignment_list=function(){$scope.popover.hide(),$state.go("assignment_list")}}]);var app1=angular.module("starter");app1.controller("profilectrl",["$scope","$location","$window","$ionicPopup","$cordovaCamera","$http","$state","$ionicModal","$cordovaFileTransfer","$ionicHistory","$ionicLoading",function($scope,$location,$window,$ionicPopup,$cordovaCamera,$http,$state,$ionicModal,$cordovaFileTransfer,$ionicHistory,$ionicLoading){loader.dependency=$ionicLoading;$scope.showPopup=function(){var myPopup=$ionicPopup.show({template:'<button class="button button-full button-assertive" on-tap="takePhoto()">Take Photo</button><button class="button button-full button-assertive" on-tap="choosePhoto()">Choose Photo</button>',title:"Select Picture",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});myPopup.then(function(res){}),$scope.takePhoto=function(){var options={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0};$cordovaCamera.getPicture(options).then(function(imageData){$scope.imgURI=imageData,myPopup.close()},function(err){})},$scope.choosePhoto=function(){var options={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){$scope.imgURI=imageData,myPopup.close()},function(err){})}};for(var jsonresponse=Service_Store.getLocal("parentdata"),json=$.parseJSON(jsonresponse),i=0;i<json.length;i++)var name=(json[i].id,json[i].name),userEmail=json[i].email,member_no=json[i].member_no,member_no=(json[i].type,json[i].member_no),userImage=json[i].image,type=json[i].type;$scope.name=name,$scope.email=userEmail,$scope.member_no=member_no,name=document.getElementById("name").value,email=document.getElementById("email").value,userImage?$scope.imgURI=global.config.file_url+global.config.image_path+"/profile_image/"+userImage+"?"+global.randomNumber():$scope.imgURI="img/chat_user.png?"+global.randomNumber(),$scope.editprofile=function(){var imageName=$scope.imgURI,params={};params.name=$scope.name,params.member_no=$scope.member_no;var options=new FileUploadOptions;options.fileKey="upload_file",options.fileName="1.jpg",options.mimeType="image/jpeg",options.params=params,options.chunkedMode=!1,$cordovaFileTransfer.upload(global.config.api_url+"/student/updateimage?token="+Service_Store.getLocal("app_token"),imageName,options).then(function(result){var json=$.parseJSON(result.response),image_name=json.img_name;Service_Store.setLocal("das_userimage",image_name);var jsonresponse=Service_Store.getLocal("parentdata"),json=JSON.parse(jsonresponse);json[0].image=image_name;var imagedata=JSON.stringify(json);Service_Store.setLocal("parentdata",imagedata);var json=(Service_Store.getLocal("parentdata"),JSON.parse(jsonresponse));global._alert({template:"Profile updated...",dependency:$ionicPopup}),$state.go("dashboard",{},{reload:!0})},function(err){global._alert({template:"Network problem profile not update",dependency:$ionicPopup})},function(progress){})},$scope.backButton=function(){$ionicHistory.goBack()},$scope.logout=function(){try{var deviceId=Service_Store.getLocal("das_device_id"),app_token=Service_Store.getLocal("app_token");Service_Store.clearAll(),Service_Store.setLocal("das_device_id",deviceId),Service_Store.setLocal("app_token",app_token),$window.location.href="#/login",global._alert({template:"Successfully logged Out!",dependency:$ionicPopup}),classmessage_socket.disconnect()}catch(ex){}},$scope.changepassword=function(){$ionicModal.fromTemplateUrl("templates/changepassword.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})},$scope.openPrivacy=function(){$ionicModal.fromTemplateUrl("templates/privacy.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})},$scope.openTerms=function(){$ionicModal.fromTemplateUrl("templates/terms.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show()})},$scope.showConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:'<img src="img/alert.png" class="alert"/><b>Classgenie</b>',template:"Are you sure you want to delete Your account?"});confirmPopup.then(function(res){return!!res&&void $scope.deleteaccount()})},$scope.deleteaccount=function(){if(2==type)var url="teacher";else if(3==type)var url="parent";ajaxloader.loadURL(global.config.api_url+"/"+url+"/delete?token="+Service_Store.getLocal("app_token")+"&member_no="+member_no,{},$scope.studentDeleteResponse=function(resp){if("Success"==resp.status){ajaxloader.async=!0,$scope.logout();var message="Account has been deleted";window.plugins.toast.show(message,"short","center")}else"Failure"==resp.status?window.plugins.toast.show(message,"short","center"):global._alert({template:resp.error_msg,dependency:$ionicPopup})})},$scope.closePrivacy=function(){$scope.modal.remove()},$scope.openNotification=function(){$state.go("notification_setting")}}]);var addClass=angular.module("starter");addClass.controller("addClassCtrl",["$scope","$ionicPopup","$location","$window","$ionicHistory","$ionicLoading",function($scope,$ionicPopup,$location,$window,$ionicHistory,$ionicLoading){$scope.image="img/6_6_c_6.png";for(var jsonresponse=Service_Store.getLocal("parentdata"),json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){var member_no=(json[i].id,json[i].name,json[i].email,json[i].member_no);json[i].type}ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classlist?token="+Service_Store.getLocal("app_token"),function(resp){$scope.selectGrades=$.parseJSON(resp),ajaxloader.async=!0}),$scope.classIconPopup=function(){var output=(global.config.api_url+"/classinfo?token="+Service_Store.getLocal("app_token"),"");ajaxloader.load(global.config.api_url+"/classinfo?token="+Service_Store.getLocal("app_token"),function(resp){data=$.parseJSON(resp),mylist_data=data.user_list,Object.keys(mylist_data).forEach(function(key){var imageName=mylist_data[key].image,imagePath=global.config.file_url+"assets/class/"+imageName;output+="<img ng-src="+imagePath+' ng-click="setImage($event)"  id='+key+' ng-name="add_class_user" />'});var myPopup=$ionicPopup.show({template:output,title:"Choose Class Icon",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.setImage=function(event){var imageId=event.target.id;$scope.image=$("#"+imageId).attr("src"),myPopup.close()},myPopup.then(function(res){})})};var gradeValue="";$scope.showSelectValue=function(selectGrade){gradeValue=selectGrade},$scope.createNewClass=function(){var image_name="",s=$scope.image,fields=s.split("/");image_name=fields[5];$scope.className;""!=image_name&&null!=image_name||(image_name="6_6_c_6.png"),ajaxloader.loadURL(global.config.api_url+"/classinfo?token="+Service_Store.getLocal("app_token"),{class_name:$scope.className,image:image_name,grade:gradeValue,teacher_ac_no:member_no},$scope.addResponse)},$scope.addResponse=function(resp){if("Success"==resp.status){var res=JSON.stringify(resp.user_list),json=$.parseJSON(res),class_id=json[0].class_id;Service_Store.setLocal("das_classid",class_id),$window.location.href="#/addstudent"}else 1==resp.error_code?global._alert({template:resp.error_msg,dependency:$ionicPopup}):global._alert({template:resp.comments,dependency:$ionicPopup})}}]),add_class_goBack=function(){window.location.href="#/dashboard"};var addStudent=angular.module("starter");addStudent.controller("addStudentCtrl",["$scope","$window","$location","$ionicHistory","$ionicPopup","$state",function($scope,$window,$location,$ionicHistory,$ionicPopup,$state){$scope.items=[];var jsonresponse=Service_Store.getLocal("parentdata"),classId=Service_Store.getLocal("das_classid");$scope.imagePath=global.config.file_url;for(var json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){json[i].id,json[i].name,json[i].email,json[i].member_no,json[i].type}studentlisting=function(){document.getElementById("student_name").value="";global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+classId,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if("Success"==res1.status){var class_studentlist=res1.class_details.student_list;$scope.items=class_studentlist}})},studentlisting(),$scope.addStudent=function(){var studentName=$scope.student_name;global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/addstudent?token="+Service_Store.getLocal("app_token"),{name:studentName,class_id:classId},function(resp){if(ajaxloader.async=!0,"Success"==resp.status){var responseJson=resp.user_list,jsonObj=JSON.stringify(responseJson);Service_Store.setLocal("studentdata",jsonObj),studentlisting(),$state.go("addstudent",{},{reload:!0})}else 1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})})},$scope.openParentPage=function(){$window.location.href="#/inviteparent"}}]),add_student_goBack=function(){var classId=Service_Store.getLocal("das_classid"),backValue=Service_Store.getLocal("das_classBack");"classback"==backValue?window.location.href="#/tab/"+classId+"/classroom":window.location.href="#/dashboard"};var app=angular.module("starter");app.controller("tabcontroller",function($scope,$window,$location){$scope.classroomid=Service_Store.getLocal("das_classid")});var app=angular.module("starter");app.service("productService",function(){var productList=[],addProduct=function(newObj){productList.push(newObj)},getProducts=function(){return productList};return{addProduct:addProduct,getProducts:getProducts}});var myEdit_skill=angular.module("starter");myEdit_skill.controller("editskillsCtrl",["$scope","$http","$window","$location","$ionicModal","$ionicPopup","$ionicLoading","$base64",function($scope,$http,$window,$location,$ionicModal,$ionicPopup,$ionicLoading,$base64){loader.dependency=$ionicLoading,$scope.positiveskill=!0,$scope.needsworkskill=!1,$("#pskillbutton").addClass("color_change"),$("#nskillbutton").removeClass("color_change");var stored_classId=Service_Store.getLocal("das_classid");Service_Store.getLocal("das_member_no");$scope.imagePath=global.config.file_url+global.config.image_path,global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/points/class/?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){ajaxloader.async=!0;var positive=res1.user_list,needwork=res1.needwork;$scope.class_award_items=positive,$scope.class_needwork_items=needwork,$scope.items=res1.user_list}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})}),$scope.addNewSkill=function(){$window.location.href="#addskill"},$scope.addNeedWork=function(){$window.location.href="#addNeedWork"},$scope.editSkill=function(){Service_Store.setLocal("skillId",this.item.id),Service_Store.setLocal("skillName",this.item.name),Service_Store.setLocal("pointweight",this.item.pointweight),Service_Store.setLocal("imageName",this.item.image),$window.location.href="#single_editskill"},$scope.goBack=function(){$window.location.href="#tab/"+stored_classId+"/classroom"},$scope.needButton=function(){$("#nskillbutton").addClass("color_change"),$("#pskillbutton").removeClass("color_change"),$scope.positiveskill=!1,$scope.needsworkskill=!0},$scope.positiveButton=function(){$("#pskillbutton").addClass("color_change"),$("#nskillbutton").removeClass("color_change"),$scope.positiveskill=!0,$scope.needsworkskill=!1}}]);var addClass=angular.module("starter");addClass.controller("addskillCtrl",["$scope","$ionicPopup","$location","$window","$ionicHistory","$ionicLoading","$base64",function($scope,$ionicPopup,$location,$window,$ionicHistory,$ionicLoading,$base64){loader.dependency=$ionicLoading,$scope.image="img/20_icon_2.png";for(var stored_classId=Service_Store.getLocal("das_classid"),jsonresponse=Service_Store.getLocal("parentdata"),json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){var member_no=(json[i].id,json[i].name,json[i].email,json[i].member_no);json[i].type}$scope.classIconPopup=function(){var url=global.config.api_url+"/editskills/imagelist?token="+Service_Store.getLocal("app_token"),output="";ajaxloader.load(url,function(data){data=$.parseJSON(data),mylist_data=data.user_list,Object.keys(mylist_data).forEach(function(key){var imageName=mylist_data[key].image,imagePath=global.config.file_url+"assets/skill/"+imageName;output+="<img ng-src="+imagePath+' ng-click="setImage($event)"  id='+key+' ng-name="add_class_user" />'});var myPopup=$ionicPopup.show({template:output,title:"Choose Class Icon",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.setImage=function(event){var imageId=event.target.id;$scope.image=$("#"+imageId).attr("src"),myPopup.close()},myPopup.then(function(res){})})};var gradeValue="";$scope.showSelectValue=function(selectGrade){gradeValue=selectGrade},$scope.addNewSkill=function(){var s=$scope.image,fields=s.split("/"),image_name=fields[5];$scope.skillName;""!=image_name&&null!=image_name||(image_name="20_icon_2.png"),global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/editskills?token="+Service_Store.getLocal("app_token"),{name:$base64.encode($scope.skillName),image:image_name,pointweight:gradeValue,member_no:member_no,class_id:stored_classId},$scope.addResponse)},$scope.addResponse=function(resp){"Success"==resp.status?$window.location.href="#editskills":1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})}}]),add_skill_goBack=function(){window.location.href="#editskills"};var singleSkill=angular.module("starter");singleSkill.controller("singleSkillCtrl",["$scope","$http","$window","$location","$ionicModal","$ionicPopup","$ionicLoading","$base64",function($scope,$http,$window,$location,$ionicModal,$ionicPopup,$ionicLoading,$base64){loader.dependency=$ionicLoading;Service_Store.getLocal("das_classid"),Service_Store.getLocal("das_member_no");$scope.imagePath=global.config.api_url+global.config.image_path;var skill_id=Service_Store.getLocal("skillId"),skill_name=Service_Store.getLocal("skillName"),imageName=(Service_Store.getLocal("pointweight"),Service_Store.getLocal("imageName"));$scope.skillname=skill_name,$scope.image=global.config.file_url+"/assets/skill/"+imageName,ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/classlist/positivepointweight?token="+Service_Store.getLocal("app_token"),function(resp){$scope.selectGrades=$.parseJSON(resp),ajaxloader.async=!0}),Service_Store.getLocal("pointweight")<0&&ajaxloader.load(global.config.api_url+"/classlist/negativepointweight?token="+Service_Store.getLocal("app_token"),function(resp){$scope.selectGrades=$.parseJSON(resp),ajaxloader.async=!0}),$scope.classIconPopup=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/editskills/imagelist?token="+Service_Store.getLocal("app_token"),function(resp){var res1=$.parseJSON(resp),output="";if("Success"==res1.status){var skill_data=res1.user_list;Object.keys(skill_data).forEach(function(key){var imageName=skill_data[key].image,imagePath=global.config.file_url+"/assets/skill/"+imageName;output+="<img ng-src="+imagePath+' on-tap="setImage($event)"  id='+key+' ng-name="add_class_user" />'});var myPopup=$ionicPopup.show({template:output,title:"Choose Skill Icon",subTitle:"",scope:$scope});$scope.setImage=function(event){var imageId=event.target.id;$scope.image=$("#"+imageId).attr("src"),myPopup.close()},myPopup.then(function(res){})}else 1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})})};var gradeValue="";$scope.showSelectValue=function(selectGrade){gradeValue=selectGrade},$scope.editSkill=function(){var s=$scope.image,fields=s.split("/"),image_name=fields[6];$scope.skillname;global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/editskills/update?token="+Service_Store.getLocal("app_token"),{name:$base64.encode($scope.skillname),pointweight:gradeValue,image:image_name,id:skill_id},function(resp){"Success"==resp.status&&(global._alert({template:$scope.skillname+" skill updated..",dependency:$ionicPopup}),$window.location.href="#/editskills")})},$scope.removeSkill=function(){var s=$scope.image,fields=s.split("/");fields[6],$scope.skillname;global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/editskills/delete?token="+Service_Store.getLocal("app_token"),{id:skill_id},function(resp){"Success"==resp.status&&($window.location.href="#/editskills")})}}]),edit_skill_goBack=function(){window.location.href="#/editskills"};var addStudent=angular.module("starter");addStudent.controller("editStudentCtrl",["$scope","$window","$location","$ionicPopup","$ionicLoading","$state",function($scope,$window,$location,$ionicPopup,$ionicLoading,$state){loader.dependency=$ionicLoading,$scope.items=[];var jsonresponse=Service_Store.getLocal("parentdata");$scope.imagePath=global.config.file_url;for(var json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){var member_no=(json[i].id,json[i].name,json[i].email,json[i].member_no);json[i].type}var stored_classId=Service_Store.getLocal("das_classid");loadData=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if("Success"==res1.status){var class_studentlist=res1.class_details.student_list;$scope.items=class_studentlist}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},loadData(),$scope.editStudent=function(){var studentName=$scope.student_name;""==studentName||null==studentName||(global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/addstudent?token="+Service_Store.getLocal("app_token"),{name:studentName,parent_ac_no:member_no,class_id:stored_classId},function(resp){if(ajaxloader.async=!0,"Success"==resp.status){var responseJson=resp.user_list,jsonObj=JSON.stringify(responseJson);$scope.items=$.parseJSON(jsonObj),$scope.student_name=""}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})}))},$scope.editStudentPage=function(){var studentName=this.item.name,studentId=this.item.id,student_imageName=this.item.image;Service_Store.setLocal("stud_name",studentName),Service_Store.setLocal("stud_id",studentId),Service_Store.setLocal("stud_imageName",student_imageName),$window.location.href="#/editstudent"}}]),goBack=function(){window.location.href="#/tab/"+Service_Store.getLocal("das_classid")+"/classroom"};var edit_student=angular.module("starter");edit_student.controller("editStudentCtrl2",["$scope","$window","$location","$ionicPopup","$state","$ionicLoading","$cordovaToast",function($scope,$window,$location,$ionicPopup,$state,$ionicLoading,$cordovaToast){loader.dependency=$ionicLoading;Service_Store.getLocal("das_classid"),Service_Store.getLocal("das_member_no");$scope.imagePath=global.config.file_url+global.config.image_path,$scope.studentName=Service_Store.getLocal("stud_name");var studentId=Service_Store.getLocal("stud_id"),imageName=Service_Store.getLocal("stud_imageName");$scope.name=Service_Store.getLocal("stud_name"),$scope.image=$scope.imagePath+"student/"+imageName,$scope.classIconPopup=function(){var output=(global.config.api_url+"/addstudent/list?token="+Service_Store.getLocal("app_token"),"");global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/addstudent/list?token="+Service_Store.getLocal("app_token"),function(resp){data=$.parseJSON(resp),mylist_data=data.user_list,Object.keys(mylist_data).forEach(function(key){var imageName=mylist_data[key].image,imagePath=global.config.file_url+"assets/student/"+imageName;output+="<img ng-src="+imagePath+' ng-click="setImage($event)"  id='+key+' ng-name="add_class_user" />'});var myPopup=$ionicPopup.show({template:output,title:"Choose Class Icon",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.setImage=function(event){var imageId=event.target.id;$scope.image=$("#"+imageId).attr("src"),myPopup.close()},myPopup.then(function(res){})})},$scope.updateStudent=function(){var studentName=$scope.name,image_name="",s=$scope.image,fields=s.split("/");image_name=fields[5],"student"!=image_name&&null!=image_name||(image_name="6_6_c_6.png"),global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/addstudent/update?token="+Service_Store.getLocal("app_token"),{name:studentName,image:image_name,id:studentId},function(resp){"Success"==resp.status?(global._alert({template:"Student successfully updated!",dependency:$ionicPopup}),$state.go("editstudentlist"),window.plugins.toast.show("student successfully updated","short","center")):1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})})},$scope.removeStudent=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/addstudent/delete?token="+Service_Store.getLocal("app_token"),{id:studentId},function(resp){"Success"==resp.status&&(global._alert({template:"Student successfully deleted!",dependency:$ionicPopup}),$window.location.href="#/editstudentlist",$state.go("editstudentlist"),window.plugins.toast.show("Student removed","short","center"))})},$scope.edit_student_goBack=function(){$state.go("editstudentlist")}}]);var classmessage=angular.module("starter"),classmessage_socket,ionicPopup,classmessage_class_id,member_no;classmessage.controller("classMessageCtrl",["$scope","$window","$state","$location","$ionicPopup","$ionicLoading",function($scope,$window,$state,$location,$ionicPopup,$ionicLoading){loader.dependency=$ionicLoading,ionicPopup=$ionicPopup,classmessage_class_id=Service_Store.getLocal("das_classid"),member_no=$.trim(Service_Store.getLocal("das_member_no")),$scope.class_id=classmessage_class_id,$scope.classname=Service_Store.getLocal("das_classname"),classmessage_socket=io.connect(global.config.chatting_url,{"force new connection":!0}),loader.init(),classmessage_socket.emit("new user",{member_no:member_no,source:"teacher"}),$scope.getUserlist=function(class_id){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/studentmessagelist?token="+Service_Store.getLocal("app_token")+"&class_id="+class_id+"&sort_by=A",function(resp){var resp=$.parseJSON(resp);$scope.user_list=resp.user_list,$scope.user_list.length>0?(fillMessageHtml($scope,$ionicPopup),$scope.no_of_users<2&&$("div.massage-list #lnk_all_parents").hide()):$("div.massage-list #no_of_users").html(0),ajaxloader.async=!0})},$scope.checkUserList=function(){$.inArray($scope._source,["teacher","parent","chatting"])>-1&&$scope.getUserlist(classmessage_class_id)},classmessage_socket.on("users",function(source){loader.close(),$scope._source=source,$scope.checkUserList()}),$scope.doRefresh=function(){"undefined"!=typeof $scope._source&&(ajaxloader.show_loader=!1,$scope.checkUserList(),ajaxloader.show_loader=!0),$scope.$broadcast("scroll.refreshComplete")},$scope.$on("$destroy",function(){clearAll()})}]),classmessage.controller("parentMessageCtrl",["$scope","$window","$location","$state","$ionicPopup","$ionicPopover",function($scope,$window,$location,$state,$ionicPopup,$ionicPopover){member_no=$.trim(Service_Store.getLocal("das_member_no")),classmessage_socket=io.connect(global.config.chatting_url,{"force new connection":!0}),loader.init(),classmessage_socket.emit("new user",{member_no:member_no,source:"parent"}),$scope.openSideMenu=function($event){$scope.popover_items=[{name:"Remove student"},{name:"Account"}];var template='<ion-popover-view class="dropdownsetting custom_drop"><ion-content><ul ><li class="item" ng-click="removeStudent()"><a>Remove student</a></li><li class="item" ng-click="profile()"><a>Account</a></li></ul></ion-content></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.removeStudent=function(){$state.go("remove_student"),$scope.popover.hide()},$scope.profile=function(){$window.location.href="#/parent_profile",$scope.popover.hide()}},$scope.getUserlist=function(member_no){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/teacherchatlist?token="+Service_Store.getLocal("app_token")+"&parent_ac_no="+member_no+"&sort_by=A",function(resp){$scope.user_list=$.parseJSON(resp),$scope.user_list.length>0?fillParentMessageHtml($scope,$ionicPopup):($("div#chat_list").show(),$("div#chat_list").html("<center>No teacher is connected!</center>")),ajaxloader.async=!0})},$scope.checkUserList=function(){$.inArray($scope._source,["teacher","parent","chatting"])>-1&&$scope.getUserlist(member_no)},classmessage_socket.on("users",function(source){loader.close(),$scope._source=source,$scope.checkUserList()}),$scope.doRefresh=function(){"undefined"!=typeof $scope._source&&(ajaxloader.show_loader=!1,$scope.checkUserList(),ajaxloader.show_loader=!0),$scope.$broadcast("scroll.refreshComplete")},$scope.$on("$destroy",function(){clearAll()})}]),fillMessageHtml=function($scope,$ionicPopup){$scope.no_of_users=0,$scope.online_user="",$scope.offline_user="",$scope.pending_user="",$scope.notification_sender_ac_no="",$.each($scope.user_list,function(index,val){"undefined"!=typeof val.parent_detail&&($scope.notification_sender_ac_no+=","+val.parent_ac_no)}),""!=$scope.notification_sender_ac_no&&($scope.notification_sender_ac_no=$scope.notification_sender_ac_no.substring(1)),chat_notification={},global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/teacher/chat_notification?token="+Service_Store.getLocal("app_token")+"&receiver_ac_no="+member_no+"&notification_sender_ac_no="+$scope.notification_sender_ac_no,function(resp){ajaxloader.async=!0,$.each($.parseJSON(resp),function(index,val){"undefined"==typeof chat_notification[val.sender_ac_no]&&(chat_notification[val.sender_ac_no]=[]),"undefined"==typeof chat_notification[val.sender_ac_no][val.receiver_class_id]&&(chat_notification[val.sender_ac_no][val.receiver_class_id]=[]),chat_notification[val.sender_ac_no][val.receiver_class_id].push(index)})}),$.each($scope.user_list,function(index,val){"undefined"!=typeof val.parent_detail&&("undefined"==typeof chat_notification[val.parent_ac_no]||"undefined"==typeof chat_notification[val.parent_ac_no][val.class_id]?val.parent_detail.read_messages=0:val.parent_detail.read_messages=chat_notification[val.parent_ac_no][val.class_id].length,$scope.online_user+='<div class="item item-avatar"><img src="img/chat_user.png"><h2 onclick="setParentDetail({name:\''+val.name+"',parent_ac_no:'"+val.parent_ac_no+'\'})" style="cursor: pointer;"><span style="font-weight:'+(0==val.parent_detail.read_messages?"normal":"bold")+'">'+val.name+"'s Parent"+(0==val.parent_detail.read_messages?"":"("+val.parent_detail.read_messages+")")+"</span>",$scope.online_user+="</h2></div>",$scope.no_of_users++),"undefined"==typeof val.parent_detail&&($scope.pending_user+='<div onclick="inviteParent()" class="item item-avatar"><img src="img/chat_user.png"><h2 onclick="inviteParent();"><span>'+val.name+"'s Parent</span>",$scope.pending_user+='</h2><p><a href="#/inviteparent">Invite parent</a></p></div>')}),$("div.massage-list #no_of_users").html($scope.no_of_users),$("div.massage-list #chat_list").html($scope.online_user+$scope.offline_user+$scope.pending_user),$("div.massage-list #lnk_all_parents").fadeIn(500),$("div.massage-list #chat_list").fadeIn(500),inviteParent=function(){window.location.href="#/inviteparent"}},fillParentMessageHtml=function($scope,$ionicPopup){$scope.no_of_users=0,$scope.online_user="",$scope.offline_user="",$scope.notification_sender_ac_no="";var count_teacher_info=0;$.each($scope.user_list,function(index,val){"undefined"!=typeof val.teacher_info&&($scope.notification_sender_ac_no+=","+val.class_info.teacher_ac_no)}),""!=$scope.notification_sender_ac_no&&($scope.notification_sender_ac_no=$scope.notification_sender_ac_no.substring(1)),chat_notification={},global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/teacher/chat_notification?token="+Service_Store.getLocal("app_token")+"&receiver_ac_no="+member_no+"&notification_sender_ac_no="+$scope.notification_sender_ac_no,function(resp){ajaxloader.async=!0,$.each($.parseJSON(resp),function(index,val){"undefined"==typeof chat_notification[val.sender_ac_no]&&(chat_notification[val.sender_ac_no]=[]),"undefined"==typeof chat_notification[val.sender_ac_no][val.receiver_class_id]&&(chat_notification[val.sender_ac_no][val.receiver_class_id]=[]),chat_notification[val.sender_ac_no][val.receiver_class_id].push(index)})}),$.each($scope.user_list,function(index,val){"undefined"!=typeof val.teacher_info&&(count_teacher_info++,"undefined"==typeof chat_notification[val.class_info.teacher_ac_no]||"undefined"==typeof chat_notification[val.class_info.teacher_ac_no][val.class_id]?val.teacher_info.read_messages=0:val.teacher_info.read_messages=chat_notification[val.class_info.teacher_ac_no][val.class_id].length,$scope.online_user+='<div class="item item-avatar" onclick="setTeacherDetail({name:\''+val.teacher_info.name+"',teacher_ac_no:'"+val.class_info.teacher_ac_no+"',class_id:'"+val.class_id+'\'})"><img src="img/chat_user.png"><h2 style="cursor: pointer;"><span style="font-weight:'+(0==val.teacher_info.read_messages?"normal":"bold")+'">'+val.teacher_info.name+(0==val.teacher_info.read_messages?"":"("+val.teacher_info.read_messages+")")+"</span>",$scope.online_user+="</h2><p>"+val.class_info.class_name+"</p></div>",$scope.no_of_users++)}),0==count_teacher_info?($("div#chat_list").html("<center>No teacher is connected!</center>"),$("div#chat_list").show()):($("div.massage-list #chat_list").html($scope.online_user+$scope.offline_user),$("div.massage-list #chat_list").fadeIn(500))},setParentDetail=function(obj){clearAll(),Service_Store.setLocal("message_account_name",obj.name),window.location.href="#/"+obj.parent_ac_no+"/chat"},setParentDetailAll=function(){0==$.trim($("#no_of_users").html())?ionicPopup.alert({title:"<b>Classgenie</b>",template:"Sorry, No parent is connected!"}):(clearAll(),window.location.href="#/"+classmessage_class_id+"/chat")},setTeacherDetail=function(obj){clearAll(),Service_Store.setLocal("chat_classid",obj.class_id),window.location.href="#/"+obj.teacher_ac_no+"/chat"},goToDashBoard=function(){clearAll(),window.location.href="#/dashboard"},goToDashBoardParent=function(){clearAll(),window.location.href="#/home/class_story"},clearAll=function(){classmessage_socket.disconnect()};var timer=12e4,classmessage=angular.module("starter"),sender_ac_no,sender_name,receiver_ac_no,receiver_name,ionicPopup;classmessage.controller("chatCtrl",["$scope","$window","$location","$interval","$timeout","$ionicScrollDelegate","$ionicPopup","$cordovaCamera","$cordovaFileTransfer","$cordovaCapture","$compile","$ionicLoading",function($scope,$window,$location,$interval,$timeout,$ionicScrollDelegate,$ionicPopup,$cordovaCamera,$cordovaFileTransfer,$cordovaCapture,$compile,$ionicLoading){
loader.dependency=$ionicLoading,ionicPopup=$ionicPopup,sender_ac_no=$.trim(Service_Store.getLocal("das_member_no")),Service_Store.getLocal("parentdata")&&(sender_name=$.trim($.parseJSON(Service_Store.getLocal("parentdata"))[0].name)),$scope.class_id=$.trim(Service_Store.getLocal("das_classid")),$scope.member_no=$location.path().split("/")[1],$scope.message="",$scope.page_number=1,$scope.socket=io.connect(global.config.chatting_url,{"force new connection":!0}),$scope.showEmotionList=function(){showEmotionList($scope,$ionicPopup)},$scope.showPicturePopup=function(){showPicturePopup($scope,$ionicPopup,$cordovaCamera,$cordovaCapture)},$scope.load_page_init=function(){if($scope.load_pager_init=!0,/^-?[0-9]+$/.test($scope.member_no))2==sender_ac_no.substr(0,1)?($scope.parent_id=$scope.member_no,$scope.teacher_id=sender_ac_no):($scope.class_id=$.trim(Service_Store.getLocal("chat_classid")),$scope.teacher_id=$scope.member_no,$scope.parent_id=sender_ac_no),updateNotification(sender_ac_no,$scope.member_no,$scope.class_id),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/parent/search?token="+Service_Store.getLocal("app_token")+"&member_no="+$scope.member_no,function(resp){var resp=$.parseJSON(resp);receiver_ac_no=$scope.member_no,receiver_name=resp.user_list[0].name,$scope.Name="Message",ajaxloader.async=!0}),loadMessages({teacher_id:$scope.teacher_id,parent_id:$scope.parent_id},{timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate,scope:$scope,compile:$compile});else{$scope.Name="All Parents",$scope.teacher_id=sender_ac_no;var parent_ac_nos="",receiver_names="",receiver_ac_nos="";global.checkNetworkConnection(ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/studentmessagelist?token="+Service_Store.getLocal("app_token")+"&class_id="+$scope.member_no+"&source=chat&sort_by=A",function(resp){ajaxloader.async=!0;var resp=$.parseJSON(resp);$.each(resp.user_list,function(index,value){"0"!=value.parent_ac_no&&(parent_ac_nos+=","+value.parent_ac_no,receiver_names+=","+value.parent_detail.name,receiver_ac_nos+=","+value.parent_ac_no)}),""!=parent_ac_nos?($scope.parent_id=parent_ac_nos.substring(1),receiver_name=receiver_names.substring(1),receiver_ac_no=receiver_ac_nos.substring(1),loadMessages({teacher_id:sender_ac_no,parent_id:$scope.parent_id},{timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate,scope:$scope,compile:$compile})):$scope.parent_id=""})}},$scope.load_page_init(),$scope.loadPreviousData=function(){$scope.page_number++,/^-?[0-9]+$/.test($scope.member_no)?loadMessages({teacher_id:$scope.teacher_id,parent_id:$scope.parent_id},{scope:$scope,compile:$compile,pagination:!0}):loadMessages({teacher_id:sender_ac_no,parent_id:$scope.parent_id},{scope:$scope,compile:$compile,pagination:!0})},$scope.sendMessageInit=function(source){/^-?[0-9]+$/.test($scope.member_no)?($scope.socket.emit("message",{teacher_id:$scope.teacher_id,parent_id:$scope.parent_id,message:$scope.message}),1==source?$scope.updateDBMedia($scope.teacher_id,$scope.parent_id,{teacher_id:$scope.teacher_id,parent_id:$scope.parent_id,timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate}):updateDB($scope.teacher_id,$scope.parent_id,$scope.message,{teacher_id:$scope.teacher_id,parent_id:$scope.parent_id,timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate,scope:$scope,compile:$compile}),$scope.socket.emit("new user",{member_no:sender_ac_no,source:"chatting"})):1==source?$scope.updateDBMedia(sender_ac_no,$scope.parent_id,{teacher_id:sender_ac_no,parent_id:$scope.parent_id,timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate}):updateDB(sender_ac_no,$scope.parent_id,$scope.message,{teacher_id:sender_ac_no,parent_id:$scope.parent_id,timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate,scope:$scope,compile:$compile}),$scope.message=""},$scope.sendMessage=function(keyEvent){13===keyEvent.which&&$scope.sendMessageInit()},$scope._sendMessage=function(){$scope.sendMessageInit()},$scope.socket.on("push message",function(response){sender_ac_no!=response.teacher_id&&sender_ac_no!=response.parent_id||"All Parents"==$scope.Name||loadMessages(response,{timeout:$timeout,ionicScrollDelegate:$ionicScrollDelegate,scope:$scope,compile:$compile})}),$scope.backFromChat=function(){$scope.clearAll(),3==sender_ac_no.substr(0,1)?$window.location.href="#/home/parent_messages":$window.location.href="#/tab/"+$scope.class_id+"/messages"},$scope.$on("$destroy",function(){$scope.clearAll()}),$scope.clearAll=function(){$scope.socket.disconnect()},$scope.updateDBMedia=function(teacher_id,parent_id,obj){$scope.page_number=1,$scope.load_pager_init=!0;var arr_media=$scope.message.split("."),ext=arr_media.slice(-1)[0],options=new FileUploadOptions;options.fileKey="message",options.fileName="media."+ext,options.mimeType=("mp4"==ext||"3gp"==ext?"video":"image")+"/"+ext;var params=new Object;params.teacher_id=teacher_id,params.parent_id=parent_id,params.sender_name=sender_name,params.receiver_name=receiver_name,params.sender_ac_no=sender_ac_no,params.receiver_ac_no=receiver_ac_no,params.class_id=$scope.class_id,options.params=params,options.chunkedMode=!1,$cordovaFileTransfer.upload(global.config.api_url+"/teacher/chat_media?token="+Service_Store.getLocal("app_token")+"&time="+Math.random(),$scope.message,options).then(function(result){$scope.progressBar.close(),loadMessages({teacher_id:obj.teacher_id,parent_id:obj.parent_id},{timeout:obj.timeout,ionicScrollDelegate:obj.ionicScrollDelegate,scope:$scope,compile:$compile})},function(err){alert("ERROR: "+JSON.stringify(err))},function(progress){$timeout(function(){$scope.uploadProgress=Math.floor(progress.loaded/progress.total*100),$("#myProgress").val($scope.uploadProgress)})})}}]),loadMessages=function(response,objdependency){var el="";global.checkNetworkConnection(ionicPopup),ajaxloader.load(global.config.api_url+"/teacher/chat?token="+Service_Store.getLocal("app_token")+"&teacher_id="+response.teacher_id+"&parent_id="+response.parent_id+"&class_id="+objdependency.scope.class_id+"&page_number="+objdependency.scope.page_number,function(resp){var resp=$.parseJSON(resp);1==objdependency.scope.page_number&&$(".message_chat").html(""),resp.length>0?($.each(resp,function(index,value){var _message=value.message;if(value.message.indexOf("image#$#")>-1){var msg=value.message.split("#$#");value.message="<img src='"+global.config.file_url+"assets/chat/"+msg[1]+"'>"}if(value.message.indexOf("video#$#")>-1){var msg=value.message.split("#$#"),arr_video=msg[1].split(".");value.message='<video controls="controls"><source src="'+global.config.file_url+"assets/chat/"+msg[1]+'" type="video/'+arr_video[1]+'" /></video>'}if(value.message.indexOf("emotion_image")>-1){var msg=value.message.split("~");value.message="<img src='"+global.config.file_url+"assets/chaticon/"+msg[1]+"' class='bubble_icon'>"}el=$.trim(value.sender_ac_no)==sender_ac_no?objdependency.compile('<div class="chat-bubble new_right"><div class="ion-close new_icon" ng-click="removeChat(\''+value._id+"','"+global.addslashes(_message)+"','"+value.receiver_ac_no+'\')"></div><div class="message">'+value.message+'</div><div class="message-detail"><span>'+value.sender_name+'</span>, <span data-livestamp="'+value.created_at+'" class="msg-rhs"></span></div></div>')(objdependency.scope):objdependency.compile('<div class="chat-bubble left"><div class="message ng-binding">'+value.message+'</div><div class="message-detail"><span class="bold ng-binding">'+value.sender_name+'</span>,<span data-livestamp="'+value.created_at+'" class="msg-rhs"></span></div></div>')(objdependency.scope),objdependency.pagination?$(".message_chat").prepend(el):$(".message_chat").append(el)}),objdependency.pagination||objdependency.timeout(function(){objdependency.ionicScrollDelegate.scrollBottom(!0)}),objdependency.scope.load_pager_init&&($(".message_chat .chat-bubble").length>=global.config.page_size?$("#Pagination").show():$("#Pagination").hide())):objdependency.pagination&&$("#Pagination").hide()}),objdependency.scope.removeChat=function(objectid,message,receiver_ac_no){"undefined"!=typeof objdependency.scope.page_number&&(objdependency.scope.page_number=1),global.checkNetworkConnection(ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/teacher/remove_chat?token="+Service_Store.getLocal("app_token")+"&time="+Math.random(),{objectid:objectid,message:message,receiver_ac_no:receiver_ac_no},function(resp){ajaxloader.async=!0,1==resp.message&&objdependency.scope.load_page_init()})}},updateDB=function(teacher_id,parent_id,message,obj){"undefined"!=typeof obj.scope.page_number&&(obj.scope.page_number=1,obj.scope.load_pager_init=!0),global.checkNetworkConnection(ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/teacher/chat?token="+Service_Store.getLocal("app_token")+"&time="+Math.random(),{teacher_id:teacher_id,parent_id:parent_id,message:message,sender_name:sender_name,receiver_name:receiver_name,sender_ac_no:sender_ac_no,receiver_ac_no:receiver_ac_no,class_id:obj.scope.class_id},function(resp){ajaxloader.async=!0,1==resp.message&&loadMessages({teacher_id:obj.teacher_id,parent_id:obj.parent_id},{timeout:obj.timeout,ionicScrollDelegate:obj.ionicScrollDelegate,scope:obj.scope,compile:obj.compile})})},updateNotification=function(member_no,sender_ac_no,class_id){global.checkNetworkConnection(ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/teacher/update_chat?token="+Service_Store.getLocal("app_token")+"&time="+Math.random(),{member_no:member_no,sender_ac_no:sender_ac_no,class_id:class_id},function(resp){ajaxloader.async=!0})},showEmotionList=function($scope,$ionicPopup){ajaxloader.async=!1;var output="";ajaxloader.load(global.config.api_url+"/classlist/chaticon?token="+Service_Store.getLocal("app_token"),function(resp){ajaxloader.async=!0,mylist_data=$.parseJSON(resp),$.each(mylist_data,function(index,val){var imagePath=global.config.file_url+"assets/chaticon/"+val.value;output+="<img ng-src="+imagePath+" ng-click=\"setImage('"+val.value+"')\" />"})});var myPopup=$ionicPopup.show({template:output,title:"Choose Message Icon",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.setImage=function(image_name){$scope.message="emotion_image~"+image_name,$scope.sendMessageInit(),myPopup.close()}},showPicturePopup=function($scope,$ionicPopup,$cordovaCamera,$cordovaCapture){var myPopup=$ionicPopup.show({template:'<button class="button button-full button-assertive" ng-click="takePhoto(1)">Take Photo</button><button class="button button-full button-assertive" ng-click="takePhoto(2)">Choose Photo</button><button class="button button-full button-assertive" ng-click="recordVideo()">Record video</button>',title:"Select Picture",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.takePhoto=function(type){var options={quality:75,destinationType:Camera.DestinationType.FILE_URI,sourceType:1==type?Camera.PictureSourceType.CAMERA:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:1==type};$cordovaCamera.getPicture(options).then(function(imageData){$scope.message=imageData,$scope.message.indexOf("?")>-1&&($scope.message=$scope.message.substring(0,$scope.message.indexOf("?"))),$scope.sendMessageInit(1),myPopup.close(),$scope.progressPopup()},function(err){})},$scope.recordVideo=function(){var options={limit:1,duration:30};$cordovaCapture.captureVideo(options).then(function(videoData){var file_path=videoData[0].fullPath;$scope.message=file_path,$scope.sendMessageInit(1),myPopup.close(),$scope.progressPopup()},function(err){})},$scope.progressPopup=function(){$scope.progressBar=$ionicPopup.show({template:'<progress id="myProgress" max="100" value="0"></progress>',title:"Uploading...",subTitle:"",scope:$scope})}};var app=angular.module("starter");app.controller("changepassword",["$scope","$ionicModal","$ionicPopup","$state","$ionicLoading",function($scope,$ionicModal,$ionicPopup,$state,$ionicLoading){loader.dependency=$ionicLoading,$scope.popup_title="Change password";var data=JSON.parse(Service_Store.getLocal("parentdata"));$scope.member_no=data[0].member_no,$scope.updatepassword=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/changepassword/update?token="+Service_Store.getLocal("app_token"),{password:$scope.currpass,newpassword:$scope.newpass,confirmpassword:$scope.confirmpass,member_no:$scope.member_no},$scope.updateResponse=function(resp){"Failure"==resp.status?global._alert({template:resp.comments,dependency:$ionicPopup}):(global._alert({template:"Password Successfully Updated",dependency:$ionicPopup}),$scope.modal.hide())})},$scope.backButton=function(){$scope.modal.hide()}}]);var editClass=angular.module("starter");editClass.controller("editClassCtrl",["$scope","$ionicPopup","$location","$window","$ionicHistory","$ionicLoading","$cordovaToast","$state",function($scope,$ionicPopup,$location,$window,$ionicHistory,$ionicLoading,$cordovaToast,$state){loader.dependency=$ionicLoading;var class_image=Service_Store.getLocal("das_classImage"),nameOfClass=Service_Store.getLocal("das_classname"),stored_classId=(Service_Store.getLocal("das_classGrade"),Service_Store.getLocal("das_classid"));$scope.image=global.config.file_url+"assets/class/"+class_image,$scope.className=nameOfClass,ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classlist?token="+Service_Store.getLocal("app_token"),function(resp){$scope.selectGrades=$.parseJSON(resp),ajaxloader.async=!0}),$scope.classIconPopup=function(){var output=(global.config.api_url+"/classinfo?token="+Service_Store.getLocal("app_token"),"");ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classinfo?token="+Service_Store.getLocal("app_token"),function(resp){ajaxloader.async=!0,data=$.parseJSON(resp),mylist_data=data.user_list,Object.keys(mylist_data).forEach(function(key){var imageName=mylist_data[key].image,imagePath=global.config.file_url+"assets/class/"+imageName;output+="<img ng-src="+imagePath+' on-tap="setImage($event)"  id='+key+' ng-name="add_class_user" />'});var myPopup=$ionicPopup.show({template:output,title:"Choose Class Icon",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});$scope.setImage=function(event){var imageId=event.target.id;$scope.image=$("#"+imageId).attr("src"),myPopup.close()},myPopup.then(function(res){})})};var gradeValue="";$scope.showSelectValue=function(selectGrade){gradeValue=selectGrade},$scope.updateClass=function(){var image_name="",s=$scope.image,fields=s.split("/");image_name=fields[5];$scope.className;""!=image_name&&null!=image_name||(image_name="17_c_17.png"),ajaxloader.loadURL(global.config.api_url+"/classinfo/update?token="+Service_Store.getLocal("app_token"),{class_name:$scope.className,image:image_name,grade:gradeValue,class_id:stored_classId},$scope.addResponse)},$scope.addResponse=function(resp){"Success"==resp.status?(window.location.href="#/tab/"+stored_classId+"/classroom",global._alert({template:"Class Updated successfully.",dependency:$ionicPopup})):1==resp.error_code?global._alert({template:resp.error_msg,dependency:$ionicPopup}):global._alert({template:resp.comments,dependency:$ionicPopup})},$scope.removeClass=function(){$scope.showConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:'<img src="img/alert.png" class="alert"/><b>Classgenie</b>',template:"Are you sure you want to delete class "+nameOfClass+" ?"});confirmPopup.then(function(res){res&&$scope.delete()})},$scope.showConfirm(),$scope.delete=function(){ajaxloader.loadURL(global.config.api_url+"/classinfo/delete?token="+Service_Store.getLocal("app_token"),{class_id:stored_classId},$scope.deleteSuccess=function(resp){"Success"==resp.status?(window.plugins.toast.show(nameOfClass+" has been successfully removed","short","center"),$state.go("dashboard")):window.plugins.toast.show(resp.comments,"short","center")})}}}]),edit_class_goBack=function(){window.location.href="#/tab/stored_classId/classroom"};var inviteParent=angular.module("starter");inviteParent.controller("inviteParentCtrl",["$scope","$window","$location","$ionicPopup","$ionicHistory","$state","$ionicLoading","$cordovaToast",function($scope,$window,$location,$ionicPopup,$ionicHistory,$state,$ionicLoading,$cordovaToast){loader.dependency=$ionicLoading,$scope.items=[];var jsonresponse=Service_Store.getLocal("parentdata");$scope.imagePath=global.config.file_url;for(var json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){var userEmail=(json[i].id,json[i].name,json[i].email),member_no=json[i].member_no;json[i].type}var stored_classId=Service_Store.getLocal("das_classid"),class_studentlist="";$scope.loadStudent=function(){ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.class_name=res1.class_details.class_name,class_studentlist=res1.class_details.student_list,$scope.items=class_studentlist;var count=$scope.items;$scope.totalstudents=$scope.items.length;var connected=0;count.forEach(function(count){count.request_status>0&&connected++,$scope.connected=connected;var comp=connected/$scope.totalstudents*100;$scope.connected>0?(comp+="%",$("div.prog").css({width:""+comp})):$scope.connected<1&&(comp="0%",$("div.prog").css({width:""+comp}))}),count<1&&($scope.list="No students in your class")}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},$scope.loadStudent(),$scope.generateInvitationPdf=function(){ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/pdfgenerate?token="+Service_Store.getLocal("app_token")+"&member_no="+member_no+"&class_id="+stored_classId,function(resp){ajaxloader.async=!0;var res1=JSON.parse(resp);if("Success"==res1.status)$scope.inviteAllParents();else{if(1!=resp.error_code)return!1;global._alert({template:resp.error_msg,dependency:$ionicPopup})}})},$scope.inviteAllParents=function(){global._alert({template:"Great We just emailed the parent invites for class "+$scope.class_name+" to "+userEmail,dependency:$ionicPopup}),global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/sendmail?token="+Service_Store.getLocal("app_token")+"&member_no="+member_no+"&id=1&class_id="+stored_classId,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);"Success"==res1.status&&$state.go("dashboard")})},$scope.editStudentPage=function(){var studentName=this.item.name,studentId=this.item.id,student_imageName=this.item.image;Service_Store.setLocal("stud_name",studentName),Service_Store.setLocal("stud_id",studentId),Service_Store.setLocal("stud_imageName",student_imageName)},$scope.inviteParent=function(id){var studentName=this.item.name,parentNo=this.item.parent_no;$scope.data={};var layout='<input type="email" ng-model="data.email">';$ionicPopup.show({template:layout,title:"Invite Parent",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"},{text:"Invite",type:"button-positive",onTap:function(e){return $scope.data.email?(ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/sendmail?token="+Service_Store.getLocal("app_token")+"&email="+$scope.data.email+"&id=3&parent_no="+parentNo+"&teacher_name="+Service_Store.getLocal("das_username"),function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if("Success"==res1.status){var message="invitation sent to "+studentName+"'s parent";window.plugins.toast.show(message,"short","center"),$scope.loadStudent()}}),$scope.data.email):void e.preventDefault()}}]})},$scope.inviteBack=function(){$ionicHistory.goBack()}}]);var storyClass=angular.module("starter");storyClass.controller("Class_StoryCtrl",["$scope","$window","$location","$ionicPopup","$ionicPopover","$state","$ionicModal","$ionicHistory","$http","$ionicLoading",function($scope,$window,$location,$ionicPopup,$ionicPopover,$state,$ionicModal,$ionicHistory,$http,$ionicLoading){loader.dependency=$ionicLoading;var nameOfClass=(Service_Store.getLocal("das_classImage"),Service_Store.getLocal("das_classname")),stored_classId=(Service_Store.getLocal("das_classGrade"),Service_Store.getLocal("das_classid")),parent_acc_no=(Service_Store.getLocal("classStory_st_no"),Service_Store.getLocal("classStory_pt_no")),story_status=Service_Store.getLocal("classStory_status");$scope.user_name=Service_Store.getLocal("das_username"),$scope.file=global.config.file_url;var memberNo=Service_Store.getLocal("das_member_no");$scope.imagePath=global.config.file_url+global.config.image_path,$scope.videoPath=global.config.video_path+global.config.image_path,$scope.name_ofClass=nameOfClass;Service_Store.getLocal("das_userimage");$scope.pagecount=1,$scope.nameofsearch="",$scope.removeDollerChar=function(string){return string.replace("$","?")},$scope.video=function(videoId){return $scope.imagePath+"class_stories/"+videoId},$scope.getStudentClass=function(member_no){return"4"==member_no.toString().substr(0,1)?"class_story_student":""},$scope.postStory=function(){$state.go("post")},$scope.liked=!1,$scope.unliked=!1,loadData=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classstories/allPost?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId+"&member_no="+memberNo+"&page_number="+$scope.pagecount+"&name="+$scope.nameofsearch,function(resp){ajaxloader.async=!0;var res1=$.parseJSON(resp);if($scope.status_val=res1.status,"Success"==res1.status){$scope.items=res1.posts;$scope.items;$scope.items.forEach(function(list){var number=String(list.teacher_ac_no);"4"==number.substr(0,1)?list.image_folder="student_stories":"2"==number.substr(0,1)&&(list.image_folder="class_stories")});for(var i=0;i<res1.posts.length;i++){var userImage;if(""==res1.posts[i].username?(userImage=Service_Store.getLocal("das_userimage"),""==userImage||"undefined"==userImage?$scope.items[i].imgURI="img/chat_user.png":$scope.items[i].imgURI=global.config.file_url+global.config.image_path+"profile_image/"+userImage):"object"==typeof res1.posts[i].teacher_name?(userImage=res1.posts[i].teacher_name.image,$scope.items[i].imgURI=global.config.file_url+global.config.image_path+"profile_image/"+userImage):$scope.items[i].imgURI="img/chat_user.png",res1.posts[i].status)for(var j=0;j<res1.posts[i].status.length;j++)res1.posts[i].status[j].member_no==memberNo?"0"==res1.posts[i].status[j].status?$scope.items[i].liked=0:$scope.items[i].liked=1:$scope.items[i].liked=0;else $scope.items[i].liked=0}}else $window.location.href="#/classstory",global._alert({template:"No post available now..",dependency:$ionicPopup})})},loadData2=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classstories/allPost?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId+"&parent_ac_no="+parent_acc_no,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.items=res1.posts;for(var i=0;i<res1.posts.length;i++){var value1=(res1.posts[i].teacher_ac_no,$scope.teache_no.toString()),res=value1.slice(0,1);if(4==res?$scope.imagefolder="student_stories":$scope.imagefolder="class_stories",res1.posts[i].status)for(var j=0;j<res1.posts[i].status.length;j++)res1.posts[i].status[j].member_no==memberNo?"0"==res1.posts[i].status[j].status?$scope.items[i].liked=0:$scope.items[i].liked=1:$scope.items[i].liked=0;else $scope.items[i].liked=0}$scope.className=res1.class_name[0].class_name}else $window.location.href="#/classstory",global._alert({template:"No post available now..",dependency:$ionicPopup});ajaxloader.async=!0})},"all"==story_status?loadData():loadData2(),$scope.openPost=function(){$window.location.href="#/post"},$scope.openCommentPage=function(){var storyId=this.item.id,image=this.item.imgURI;Service_Store.setLocal("teacher_post_id",storyId),Service_Store.setLocal("post_userimage",image),$window.location.href="#/class_story_comments"},$scope.openLikePage=function(index){var liked_status=$("#hid_liked_status_"+index).val(),storyId=this.item.id;global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/classstories/likes?token="+Service_Store.getLocal("app_token")+"&member_no="+memberNo,{story_id:storyId,class_id:stored_classId,member_no:memberNo,status:"1"==liked_status?"-1":"1"},function(resp){ajaxloader.async=!0,"Success"==resp.status?("1"==liked_status?($("#hid_liked_status_"+index).val(0),$("#liked_id_"+index).removeClass("clicked-color")):($("#hid_liked_status_"+index).val(1),$("#liked_id_"+index).addClass("clicked-color")),$("#like_icon_"+index).html(resp.user_list[0].likes)):global._alert({template:"No post liked",dependency:$ionicPopup})})},$scope.likes=function(){var storyId=this.item.id;$ionicModal.fromTemplateUrl("templates/like_listpage.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()}),global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classstories/likesList?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId+"&story_id="+storyId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){var data1=res1.like_list;$scope.like_list_items=data1;for(var i=0;i<data1.length;i++){$scope.name=data1[i].name,$scope.imageName=data1[i].image;var s=$scope.imageName,fields=s.split("_");$scope.list_image=fields[1];var b=$scope.list_image,c=b.split("0"),check_image=c[0];2==check_image?$scope.img=$scope.imagePath+"profile_image/"+$scope.imageName:$scope.img=$scope.imagePath+"profile_image/"+$scope.imageName}ajaxloader.async=!0}}),$scope.goBack_likePage=function(){$scope.modal.hide()}},$scope.openCommentMenu=function($event){var storyId=this.item.id;Service_Store.setLocal("teacher_post_id",storyId),$scope.popover_items=[{name:"Edit"},{name:"Delete"}];var template='<ion-popover-view class="post_dropdown"><ul class="list post_drop_list"><li class="item" ng-click="editPost()"><a>Edit </a></li><li class="item" ng-click="deletePost()"><a>Delete</a></li></ul></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.editPost=function(){$scope.popover.hide(),$state.go("edit_post")},$scope.deletePost=function(){var storyId=Service_Store.getLocal("teacher_post_id");$scope.popover.hide(),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/classstories/delete?token="+Service_Store.getLocal("app_token"),{id:storyId,class_id:stored_classId},function(resp){if(ajaxloader.async=!0,"Success"==resp.status){var delete_count=resp.user_list[0].count;0==delete_count?window.location.reload():(global._alert({template:"Post deleted successfully..",dependency:$ionicPopup}),loadData())}else global._alert({template:"Post not deleted..",dependency:$ionicPopup})})}},$scope.pagging=function(){$scope.pagecount=$scope.pagecount+1,loadData()},$scope.searchStory=function(search_name){},$scope.search_story=function(){$scope.nameofsearch=$scope.search_name,$scope.nameofsearch&&loadData()}}]),back_classstory=function(){window.location.href="#/tab/"+Service_Store.getLocal("das_classid")+"/class_story_listing"};var check_parent_code=angular.module("starter");check_parent_code.controller("checkParentCtrl",["$scope","$location","$window","$ionicPopup","$ionicHistory","$ionicLoading",function($scope,$location,$window,$ionicPopup,$ionicHistory,$ionicLoading){loader.dependency=$ionicLoading;for(var jsonresponse=Service_Store.getLocal("parentdata"),json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){var member_no=(json[0].id,json[0].name,json[0].email,json[0].member_no);json[0].type}$scope.checkCode=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/parentcode?token="+Service_Store.getLocal("app_token"),{parent_no:$scope.code,parent_ac_no:member_no},$scope.check_code_Response)},$scope.check_code_Response=function(resp){"Failure"==resp.status?global._alert({template:resp.comments,dependency:$ionicPopup}):"Success"==resp.status?$window.location.href="#/home/class_story":global._alert({template:"server issue while saving,Please try after some time",dependency:$ionicPopup})},$scope.goBack=function(){$ionicHistory.goBack()}}]);var group=angular.module("starter");group.controller("groupCtrl",["$scope","$location","$window","$ionicPopup","$ionicPopover","$ionicModal","$ionicLoading","$state",function($scope,$location,$window,$ionicPopup,$ionicModal,$ionicPopover,$ionicLoading,$state){loader.dependency=$ionicLoading;var stored_classId=Service_Store.getLocal("das_classid");$scope.imagePath=global.config.file_url+global.config.image_path;var groupName="",myPopup="";loadGroup=function(){ajaxloader.load(global.config.api_url+"/groupinfo?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){var responseJson=res1.group_list;$scope.items=responseJson}else 1==res1.error_code?global._alert({template:res1.error_msg,dependency:$ionicPopup}):$scope.items=""})},loadGroup(),$scope.openGroupDetail=function(){$scope.groupName=this.item.group_name,$scope.group_id=this.item.id,global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/groupinfo/group_studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId+"&group_id="+$scope.group_id,function(resp){ajaxloader.async=!0;var res=JSON.parse(resp);if("Success"==res.status){var responseJson=res.student_info;Service_Store.setLocal("groupdata",JSON.stringify(responseJson)),$scope.values=responseJson}else 1==res.error_code&&global._alert({template:res.error_msg,dependency:$ionicPopup})}),$ionicModal.fromTemplateUrl("templates/groupstudent.html",{scope:$scope}).then(function(modal){$scope.modal2=modal,$scope.modal2.show()})},$scope.openAddGroup=function(){$state.go("add_group")},$scope.closepopup=function(){$scope.modal2.remove()},$scope.openStudentReward=function(multiple){var stored_classId=Service_Store.getLocal("das_classid");Service_Store.getLocal("das_member_no");if(void 0==multiple)var studentId=this.item.id,url="/points/student/update";else var studentId=multiple,url="/awardmultiple/class";$scope.student=this.item.name,$ionicModal.fromTemplateUrl("templates/awardpopup.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()});var stored_classId=Service_Store.getLocal("das_classid");ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/points/student?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.needwork=!1,$scope.positive=!0;var data1=res1.user_list;$scope.award_items=data1,$scope.needwork_items=res1.needwork,ajaxloader.async=!0}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})}),$scope.closeAwardPopUp=function(){$scope.modal.hide()},$scope.giveReward=function(){if("/points/student/update"==url)ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{id:studentId,pointweight:this.item.pointweight,class_id:stored_classId},function(resp){"Success"==resp.status&&loadGroup()}),$scope.modal.hide();else if("/awardmultiple/class"==url){var data={id:studentId,pointweight:this.item.pointweight,class_id:stored_classId};data=JSON.stringify(data),ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{data:data},function(resp){"Success"==resp.status&&($scope.footer=!1,$scope.addmultiple=!0,$scope.classroom=!1,$scope.addmultiplescreen=!0,
$scope.selectstudent=!0,$scope.selectone=!1,loadGroup())}),$scope.modal.hide()}}},$scope.positiveButton=function(){$scope.posbutton="award_tab",$scope.needbutton="",$scope.positive=!0,$scope.needwork=!1},$scope.needButton=function(){$scope.posbutton="",$scope.needbutton="award_tab",$scope.needwork=!0,$scope.positive=!1},$scope.openGroupReward=function(multiple){var stored_classId=Service_Store.getLocal("das_classid");Service_Store.getLocal("das_member_no");if(void 0==multiple)var url="/groupinfo/pointweight";else var studentId=multiple,url="/awardmultiple/class";$scope.closepopup(),$ionicModal.fromTemplateUrl("templates/awardpopup.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()});var stored_classId=Service_Store.getLocal("das_classid");ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/points/student?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.needwork=!1,$scope.positive=!0;var data1=res1.user_list;$scope.award_items=data1,$scope.needwork_items=res1.needwork,ajaxloader.async=!0}}),$scope.closeAwardPopUp=function(){$scope.modal.hide()},$scope.giveReward=function(){if("/groupinfo/pointweight"==url)ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{group_name:groupName,pointweight:this.item.pointweight,class_id:stored_classId,group_id:$scope.group_id,customize_skills_id:this.item.id},function(resp){"Success"==resp.status&&(loadGroup(),$scope.modal2.remove(),loadGroup(),$scope.showclassscreen(),$scope.showgroupscreen())}),$scope.modal.hide();else if("/awardmultiple/class"==url){var data={id:studentId,pointweight:this.item.pointweight,class_id:stored_classId};data=JSON.stringify(data),ajaxloader.loadURL(global.config.api_url+url+"?token="+Service_Store.getLocal("app_token"),{data:data},function(resp){"Success"==resp.status&&($scope.footer=!1,$scope.addmultiple=!0,$scope.classroom=!1,$scope.addmultiplescreen=!0,$scope.selectstudent=!0,$scope.selectone=!1,loadGroup())}),$scope.modal.hide()}}},$scope.selectmultiple=function(){$scope.footer=!0,$scope.addmultiple=!1,$scope.classroom=!0,$scope.addmultiplescreen=!1,$scope.selectstudent=!1,$scope.studentselected=!0,$scope.selectone=!0},$scope.addgroup_close=function(){$scope.modal.remove()},$scope.opengroupmenu=function(){$scope.popover_item=[{name:"Delete Group"},{name:"Edit Group"}];var template='<div><ul class="list"><li class="item" on-tap="deletegroup()"><a>Delete Group</a></li><li class="item" on-tap="editgroup()"><a>Edit Group</a></li></ul></div>';myPopup=$ionicPopup.show({template:template,title:"Group Settings",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]})},$scope.deletegroup=function(){ajaxloader.loadURL(global.config.api_url+"/groupinfo/delete?token="+Service_Store.getLocal("app_token"),{class_id:stored_classId,group_id:$scope.group_id},function(resp){"Success"==resp.status&&(myPopup.close(),loadGroup(),$scope.showclassscreen(),$scope.showgroupscreen(),$scope.closepopup())})},$scope.editgroup=function(){myPopup.close(),$scope.closepopup(),$scope.openAddGroup(),$scope.groupinfo=[],$scope.groupinfo.push({groupName:$scope.groupName,groupid:$scope.group_id}),Service_Store.setLocal("groupinfo",JSON.stringify($scope.groupinfo))}}]);var addGroup=angular.module("starter");addGroup.controller("addGroupCtrl",["$scope","$location","$window","$ionicModal","$base64","$ionicPopup","$ionicLoading","$cordovaToast","$state",function($scope,$location,$window,$ionicModal,$base64,$ionicPopup,$ionicLoading,$cordovaToast,$state){loader.dependency=$ionicLoading;var stored_classId=Service_Store.getLocal("das_classid"),data1=JSON.parse(Service_Store.getLocal("groupdata"));$scope.imagePath=global.config.file_url,$scope.selected=[],$("#name").hide(),ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);"Success"==res1.status?null==Service_Store.getLocal("groupdata")?$scope.items=res1.class_details.student_list:$scope.checkedStudent(res1.class_details.student_list,data1):1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})}),$scope.checkedStudent=function(listStudent,selectedStudent){if(""!=Service_Store.getLocal("groupinfo")){var groupinfo=JSON.parse(Service_Store.getLocal("groupinfo")),group_name=groupinfo[0].groupName;$("#groupname").val(group_name),$scope.group_id=groupinfo[0].groupid}$scope.student_name="",$scope.student_no="",listStudent.forEach(function(list_student,index){selectedStudent.forEach(function(selected_student,index1){list_student.student_no==selected_student.student_no&&(listStudent[index1].selected=1,$scope.student_name+=list_student.name+",",$scope.student_no+=list_student.student_no+",",$scope.selected.push({member_no:list_student.student_no,name:list_student.name,id:list_student.id,pointweight:list_student.pointweight}))})}),$scope.items=listStudent,""!=$scope.student_name&&($scope.student_name=$scope.student_name.substring(0,$scope.student_name.length-1)),""!=$scope.student_no&&($scope.student_no=$scope.student_no.substring(0,$scope.student_no.length-1)),$("#student_list").val($scope.student_name)},$scope.select_student=function(item){if($scope.student_name="",$scope.student_no="","#ccc"==$("#stu_"+item.student_no).css("background-color")||"rgb(204, 204, 204)"==$("#stu_"+item.student_no).css("background-color")){$("#stu_"+item.student_no).css("background-color","");var pos=$scope.selected.indexOf(item.student_no);pos==-1&&$scope.selected.splice(pos)}else $("#stu_"+item.student_no).css("background-color","#ccc"),$scope.selected.push({member_no:item.student_no,name:item.name,id:item.id,pointweight:item.pointweight});$("#studentlist_collection ion-item").each(function(index,ionItem){"#ccc"!=ionItem.style.backgroundColor&&"rgb(204, 204, 204)"!=ionItem.style.backgroundColor||($scope.student_name+=$("#stuname_"+$(ionItem).data("uniqueid")).val()+",",$scope.student_no+=$("#stuid_"+$(ionItem).data("uniqueid")).val()+",")}),""!=$scope.student_name&&($scope.student_name=$scope.student_name.substring(0,$scope.student_name.length-1)),""!=$scope.student_no&&($scope.student_no=$scope.student_no.substring(0,$scope.student_no.length-1)),$("#student_list").val($scope.student_name)},$scope.varify=function(){return $("#groupname").val().length<1?($("#groupname").css({border:"2px solid #F83434"}),$("#name").show(),!1):($("#groupname").css({border:""}),$("#name").hide(),!0)};var groupdata=[];$scope.createGroup=function(){var data=$scope.selected;if(data.length>1&&$scope.varify())if(null==Service_Store.getLocal("groupdata")){var message="";for(i=0;i<data.length;i++)groupdata.push({class_id:stored_classId,student_no:data[i].member_no,group_name:$("#groupname").val()});var lists_value=$base64.encode(JSON.stringify(groupdata));global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/groupinfo/addgroup?token="+Service_Store.getLocal("app_token"),{group:lists_value},$scope.addResponse),ajaxloader.async=!0,message="Group created"}else{var message="",data=$scope.selected;for(i=0;i<data.length;i++)groupdata.push({class_id:stored_classId,student_no:data[i].member_no,group_name:$("#groupname").val(),group_id:$scope.group_id});var lists_value=$base64.encode(JSON.stringify(groupdata));global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/groupinfo/update?token="+Service_Store.getLocal("app_token"),{group:lists_value},$scope.addResponse),ajaxloader.async=!0,groupdata=[],Service_Store.removeKey("groupdata"),Service_Store.removeKey("groupinfo"),message="Group updated"}else data.length<2&&global._alert({template:"Add more than one students to the group",dependency:$ionicPopup}),""==$("#groupname").val()&&$("#groupname").css({border:"2px solid #F83434"})},$scope.addResponse=function(resp){"Success"==resp.status?$scope.close_addgroup():1==resp.error_code&&global._alert({template:resp.error_msg,dependency:$ionicPopup})},$scope.close_addgroup=function(){$window.location.href="#/tab/"+stored_classId+"/classroom"}}]);var addClass=angular.module("starter");addClass.controller("groupListCtrl",["$scope","$location","$window","$ionicModal","$ionicPopup","$ionicLoading",function($scope,$location,$window,$ionicModal,$ionicPopup,$ionicLoading){loader.dependency=$ionicLoading,$scope.image="img/17_c_17.png",$scope.nitin=!0;var selected=[];$scope.imagePath=global.config.file_url;var stored_classId=Service_Store.getLocal("das_classid"),group_name=Service_Store.getLocal("groupName");ajaxloader.async=!1,ajaxloader.timeout=5e3,global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/classinfo/studentlist?token="+Service_Store.getLocal("app_token")+"&class_id="+stored_classId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){var class_studentlist=res1.class_details.student_list;if($scope.items=class_studentlist,null===Service_Store.getLocal("studentlist"));else{var list=JSON.parse(Service_Store.getLocal("studentlist"));list.forEach(function(list){$("#stu_"+list.member_no).hide(),$("#stu_"+list.member_no).addClass("addback")})}}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})});for(var jsonresponse=Service_Store.getLocal("parentdata"),json=$.parseJSON(jsonresponse),i=0;i<json.length;i++){json[i].id,json[i].name,json[i].email,json[i].member_no,json[i].type}$scope.selected=[],$scope.select_student=function(member){if($("#stu_"+member.student_no).prop("checked")){$("#stu_"+member.student_no).prop("checked",!1),$("#stu_"+member.student_no).css({"background-color":""});var pos=selected.indexOf(member.student_no);pos==-1&&$scope.selected.splice(pos)}else $("#stu_"+member.student_no).prop("checked",!0),$("#stu_"+member.student_no).css({"background-color":"#ccc"}),$scope.selected.push({member_no:member.student_no,name:member.name,id:member.id,pointweight:member.pointweight});var list=($scope.selected,"");$scope.selected.forEach(function(item){list+=item.name+",",$scope.student_name=list.slice(0,-1)})},$scope.addselected=function(id){$scope.selected.push({class_id:stored_classId,group_name:group_name}),Service_Store.setLocal("studentlist",JSON.stringify($scope.selected)),$scope.addstudent=void 0,$scope.modal.remove(),$scope.getstudentlist(),$scope.addstudent=!1},$scope.group_list_goBack=function(){$scope.modal.remove(),$scope.addstudent=void 0},$scope.getGroupStudents=function(){if(null===Service_Store.getLocal("studentlist"));else{var list=JSON.parse(Service_Store.getLocal("studentlist"));list.forEach(function(list){$("#stu_"+list.member_no).hide(),$("#stu_"+list.member_no).css({"background-color":"#ccc"})})}},$scope.getGroupStudents()}]);var app=angular.module("starter");app.controller("classstory_parent",["$scope","$ionicPopup","$ionicModal","$ionicPopover","$window","$location","$state","$ionicHistory","$ionicLoading","$state",function($scope,$ionicPopup,$ionicModal,$ionicPopover,$window,$location,$state,$ionicHistory,$ionicLoading,$state){loader.dependency=$ionicLoading;var classid="",student_no=Service_Store.getLocal("par_student_no"),jsonresponse=(Service_Store.getLocal("das_member_no"),Service_Store.getLocal("par_status"),Service_Store.getLocal("parentdata")),deviceId=Service_Store.getLocal("das_device_id");$scope.pagecount=1;for(var json=$.parseJSON(jsonresponse),i=0;i<json.length;i++)var name=(json[0].id,json[0].name),member_no=(json[0].email,json[0].member_no),image_user=(json[0].type,json[0].image);$scope.username=name,$scope.parent_ac_no=member_no,$scope.imagePath=global.config.file_url+global.config.image_path,$scope.videoPath=global.config.video_path+global.config.image_path,image_user?$scope.imgURI=global.config.file_url+global.config.image_path+"profile_image/"+image_user+"?"+global.randomNumber():$scope.imgURI="img/chat_user.png?"+global.randomNumber(),$scope.liked=!1,$scope.unliked=!0,Service_Store.setLocal("das_member_no",$scope.parent_ac_no),Service_Store.setLocal("das_username",name),deviceRegister=function(){ajaxloader.async=!1,global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/save_deviceid?token="+Service_Store.getLocal("app_token"),{member_no:member_no,device_id:deviceId},function(resp){ajaxloader.async=!0})},deviceRegister(),getclassid=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/parentstories?token="+Service_Store.getLocal("app_token")+"&parent_ac_no="+$scope.parent_ac_no,$scope.getclassResponse)},$scope.getclassResponse=function(resp){var res1=$.parseJSON(resp);classid=res1.class_id,ajaxloader.async=!0},getclassid();var class_id=Service_Store.setLocal("das_classid",classid);loadData=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classstories/allPost?token="+Service_Store.getLocal("app_token")+"&class_id="+classid+"&page_number="+$scope.pagecount+"&member_no="+$scope.parent_ac_no,$scope.storyResponse)},$scope.storyResponse=function(resp){var res1=$.parseJSON(resp);if($scope.status_val=res1.status,"Success"==res1.status){$scope.items=res1.posts;for(var i=0;i<res1.posts.length;i++){$scope.teacher_ac_no=res1.posts[i].teacher_ac_no;var value1=$scope.teacher_ac_no.toString(),res=value1.slice(0,1);if(4==res?$scope.imagefolder="student_stories":$scope.imagefolder="class_stories",res1.posts[i].status)for(var j=0;j<res1.posts[i].status.length;j++)res1.posts[i].status[j].member_no==member_no?"0"==res1.posts[i].status[j].status?$scope.items[i].liked=0:$scope.items[i].liked=1:$scope.items[i].liked=0;else $scope.items[i].liked=0}}else global._alert({template:"No post available now..",dependency:$ionicPopup});ajaxloader.async=!0},$scope.video=function(videoId){return $scope.imagePath+"class_stories/"+videoId},$scope.openCommentMenu=function($event){var storyId=this.item.id;Service_Store.setLocal("teacher_post_id",storyId),$scope.popover_items=[{name:"Message"}];var template='<ion-popover-view class="custom_drop"><ion-content><ul ><li class="item" ng-click="messageParent()"><a>Message</a></li></ul></ion-content></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.messageParent=function(){$scope.popover.hide(),$state.go("home.parent_messages")}},$scope.openCommentPage=function(){var storyId=this.item.id,classn=this.item.class_name,date=this.item.date;Service_Store.setLocal("teacher_post_id",storyId),Service_Store.setLocal("teacher_class",classn),Service_Store.setLocal("post_date",date),$window.location.href="#/classparent_comment"},$scope.likes=function(){var storyId=this.item.id;$ionicModal.fromTemplateUrl("templates/like_listpage.html",{scope:$scope}).then(function(modal){$scope.modal=modal,$scope.modal.show()}),$scope.goBack_likePage=function(){$scope.modal.remove()},global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/classstories/likesList?token="+Service_Store.getLocal("app_token")+"&story_id="+storyId,function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){var data1=res1.like_list;$scope.like_list_items=data1;for(var i=0;i<data1.length;i++){$scope.name=data1[i].name,$scope.imageName=data1[i].image;var s=$scope.imageName,fields=s.split("_");$scope.list_image=fields[1],$scope.img=$scope.imagePath+"profile_image/"+$scope.imageName}ajaxloader.async=!0}else 1==res1.error_code&&global._alert({template:res1.error_msg,dependency:$ionicPopup})})},$scope.openLikePage=function(index){var liked_status=$("#hid_liked_status_"+index).val(),storyId=this.item.id,idofclass=this.item.class_id;global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.loadURL(global.config.api_url+"/classstories/likes?token="+Service_Store.getLocal("app_token"),{story_id:storyId,class_id:idofclass,member_no:member_no,status:"1"==liked_status?"-1":"1"},function(resp){ajaxloader.async=!0,"Success"==resp.status?("1"==liked_status?($("#hid_liked_status_"+index).val(0),$("#liked_id_"+index).removeClass("clicked-color")):($("#hid_liked_status_"+index).val(1),$("#liked_id_"+index).addClass("clicked-color")),$("#like_icon_"+index).html(resp.user_list[0].likes)):global._alert({template:"No post liked",dependency:$ionicPopup})})},load_student_story=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.async=!1,ajaxloader.load(global.config.api_url+"/teacherstudentclassstoris/allPost?token="+Service_Store.getLocal("app_token")+"&class_id="+class_id+"&member_no="+$scope.parent_ac_no+"&student_no="+student_no,$scope.student_storyResponse)},$scope.student_storyResponse=function(resp){var res1=$.parseJSON(resp);if("Success"==res1.status){$scope.items=res1.posts,$scope.name=res1.teacher_name[0].name,$scope.likesData=res1.posts[0].likes,$scope.likesData>0?($scope.liked=!0,$scope.unliked=!1):($scope.liked=!1,$scope.unliked=!0);for(var i=0;i<res1.posts.length;i++){$scope.imageData=res1.posts[i].image;var s=$scope.imageData,fields=s.split("_"),nameOfcontent=fields[0];"image"==nameOfcontent?($scope.image={},$scope.image=$scope.imageData):$scope.video=$scope.imageData}}},$scope.openSideMenu1=function($event){$scope.popover_items=[{name:"Remove student"},{name:"Account"}];var template='<ion-popover-view class="dropdownsetting custom_drop"><ion-content><ul ><li class="item" ng-click="removeStudent()"><a>Remove student</a></li><li class="item" ng-click="profile()"><a>Account</a></li></ul></ion-content></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.removeStudent=function(){$state.go("remove_student"),$scope.popover.hide()},$scope.profile=function(){$window.location.href="#/parent_profile",$scope.popover.hide()}},loadData(),$scope.pagging=function(){$scope.pagecount=$scope.pagecount+1,loadData()}}]);var app=angular.module("starter");app.controller("hometabcontroller",["$scope","$ionicPopup","$ionicModal","$ionicPopover","$window","$ionicHistory","$state",function($scope,$ionicPopup,$ionicModal,$ionicPopover,$window,$ionicHistory,$state){$scope.openSideMenu1=function($event){$scope.popover_items=[{name:"Remove student"},{name:"Account"}];var template='<ion-popover-view class="dropdownsetting custom_drop"><ion-content><ul ><li class="item" ng-click="removeStudent()"><a>Remove student </a></li><li class="item" ng-click="profile()"><a>Account</a></li></ul></ion-content></ion-popover-view>';$scope.popover=$ionicPopover.fromTemplate(template,{scope:$scope}),$scope.popover.show($event),$scope.closePopover=function(){$scope.popover.hide()},$scope.$on("popover.hidden",function(){}),$scope.removeStudent=function(){$window.location.href="#/remove_student",$scope.closePopover()},$scope.profile=function(){$scope.closePopover(),$state.go("parent_profile")}}}]);var postStory=angular.module("starter");postStory.controller("post_StoryCtrl",["$scope","$location","$window","$ionicPopup","$cordovaCamera","$http","$state","$ionicModal","$ionicHistory","$cordovaCapture","$cordovaFileTransfer","$ionicLoading","$timeout",function($scope,$location,$window,$ionicPopup,$cordovaCamera,$http,$state,$ionicModal,$ionicHistory,$cordovaCapture,$cordovaFileTransfer,$ionicLoading,$timeout){loader.dependency=$ionicLoading;var stored_classId=Service_Store.getLocal("das_classid"),stored_memberNo=Service_Store.getLocal("das_member_no"),story_status=Service_Store.getLocal("classStory_status"),studentNo=Service_Store.getLocal("classStory_st_no"),parentNo=Service_Store.getLocal("classStory_pt_no");$scope.user_name=Service_Store.getLocal("das_username"),$scope.postData={},$scope.videoPath={},$scope.selection="0";var file_path="";$scope.showPopup=function(){var myPopup=$ionicPopup.show({template:'<button class="button button-full button-assertive" ng-click="takePhoto()">Take Photo</button><button class="button button-full button-assertive" ng-click="choosePhoto()">Choose Photo</button><button class="button button-full button-assertive" ng-click="chooseVideo()">Video</button>',title:"Select Picture",subTitle:"",scope:$scope,buttons:[{text:"Close",type:"button-default"}]});myPopup.then(function(res){}),$scope.takePhoto=function(){$scope.selection="1";var options={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!0};$cordovaCamera.getPicture(options).then(function(imageData){$scope.imgURI=imageData,myPopup.close()},function(err){})},$scope.choosePhoto=function(){$scope.selection="2";var options={quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:300,targetHeight:300,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){$scope.imgURI=imageData,myPopup.close()},function(err){})},$scope.chooseVideo=function(){$scope.selection="3";var options={limit:1,duration:30};$cordovaCapture.captureVideo(options).then(function(videoData){file_path=videoData[0].fullPath,$scope.videoPath=file_path,myPopup.close()},function(err){})}},$scope.show=function(){$ionicLoading.show({template:'<ion-spinner icon="android"></ion-spinner>'}).then(function(){})},$scope.hide=function(){$ionicLoading.hide().then(function(){})},$scope.post=function(){var textmessage=$scope.postData.message;if("0"==$scope.selection&&""!=textmessage)"all"==story_status?(global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/classstories?token="+Service_Store.getLocal("app_token"),{class_id:stored_classId,message:textmessage,teacher_ac_no:stored_memberNo,teacher_name:$scope.user_name},$scope.postResponse)):(global.checkNetworkConnection($ionicPopup),ajaxloader.loadURL(global.config.api_url+"/classstories?token="+Service_Store.getLocal("app_token"),{class_id:stored_classId,message:textmessage,teacher_ac_no:stored_memberNo,parent_ac_no:parentNo,student_no:studentNo,teacher_name:$scope.user_name},$scope.postResponse));else if("3"==$scope.selection){var textmessage=$scope.postData.message;if("all"==story_status){var params={};params.message=textmessage,params.class_id=stored_classId,params.teacher_ac_no=stored_memberNo,params.teacher_name=$scope.user_name}else{var params={};params.message=textmessage,params.class_id=stored_classId,params.teacher_ac_no=stored_memberNo,params.parent_ac_no=parentNo,params.student_no=studentNo,params.teacher_name=$scope.user_name}var s=$scope.videoPath,fields=s.split("/"),nameOfVideo=fields[6],options=new FileUploadOptions;options.fileKey="upload_file",options.fileName=nameOfVideo,options.mimeType="video/3gp",options.params=params,options.chunkedMode=!1,options.headers={Connection:"close"},$cordovaFileTransfer.upload(global.config.api_url+"/upload?token="+Service_Store.getLocal("app_token"),file_path,options).then(function(result){$scope.hide(),global._alert({template:"Post Successfully..",dependency:$ionicPopup}),$window.location.href="#/classstory"},function(err){},function(progress){$scope.show()})}else{var imageName=$scope.imgURI,textmessage=$scope.postData.message;if("all"==story_status){var params={};params.message=textmessage,params.class_id=stored_classId,params.teacher_ac_no=stored_memberNo,params.teacher_name=$scope.user_name}else{var params={};params.message=textmessage,params.class_id=stored_classId,params.teacher_ac_no=stored_memberNo,params.parent_ac_no=parentNo,params.student_no=studentNo,params.teacher_name=$scope.user_name}var options=new FileUploadOptions;options.fileKey="upload_file",options.fileName="1.jpg",options.mimeType="image/jpeg",options.params=params,options.chunkedMode=!1,$cordovaFileTransfer.upload(global.config.api_url+"/upload?token="+Service_Store.getLocal("app_token"),imageName,options).then(function(result){$scope.hide(),global._alert({template:"Post Successfully..",dependency:$ionicPopup}),$window.location.href="#/classstory"},function(err){},function(progress){$scope.show()})}},$scope.postResponse=function(resp){"Success"==resp.status?(global._alert({template:resp.comments,dependency:$ionicPopup}),$window.location.href="#/classstory"):global._alert({template:resp.comments,dependency:$ionicPopup})},$scope.backPost=function(){$ionicHistory.goBack()},$scope.progressPopup=function(){$scope.progressBar=$ionicPopup.show({template:'<progress id="myProgress" max="100" value="0"></progress>',title:"Uploading...",subTitle:"",scope:$scope})}}]);var school=angular.module("starter");school.controller("ctrlTeacherList",["$scope","$ionicModal","$state","$base64","$ionicPopup","$ionicLoading","$ionicHistory","$location","$window",function($scope,$ionicModal,$state,$base64,$ionicPopup,$ionicLoading,$ionicHistory,$location,$window){loader.dependency=$ionicLoading;var data=JSON.parse(Service_Store.getLocal("parentdata")),school_id=data[0].school_id;$scope.pagecount=1,$scope.schooladd=data.address,$scope.member_no=Service_Store.getLocal("das_member_no"),$scope.imagepath=global.config.file_url+global.config.image_path+"profile_image/";var user=Service_Store.getLocal("parentdata");user=JSON.parse(user),loadData=function(){global.checkNetworkConnection($ionicPopup),ajaxloader.load(global.config.api_url+"/schools/teacherlistlimit?token="+Service_Store.getLocal("app_token")+"&school_id="+school_id+"&page_number="+$scope.pagecount,function(resp){var resp=JSON.parse(resp);$scope.status_val=resp.status,"Success"==resp.status?($scope.items=resp.Teacher_list,$scope.listsize=$scope.items.length):global._alert({template:"No teacher list now..",dependency:$ionicPopup})})},$scope.pagging=function(){$scope.pagecount=$scope.pagecount+1,loadData()},$scope.backPage=function(){$window.location.href="#/school_story"},loadData()}]);